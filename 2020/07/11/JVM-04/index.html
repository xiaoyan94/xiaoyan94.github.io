<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169911533-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169911533-1');
</script>

  

  
  <title>JVM 04 è¿è¡Œæ—¶æ•°æ®åŒºä¹‹å † (Heap) | ç©ºåŸç›¼æ•…äºº</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google-site-verification" content="NOVpqBhVVjZHOamocUf3Grijt7xAK_Engoe_FNrxE3Q" />
  <meta name="baidu-site-verification" content="HBrapLOndy" />
  
  <meta name="keywords" content="è®¸åµ©è€å…¬" />
  
  <meta name="description" content="1 å †çš„æ ¸å¿ƒæ¦‚è¿° â— ä¸€ä¸ª JVM å®ä¾‹åªå­˜åœ¨ä¸€ä¸ªå †å†…å­˜ï¼Œå †ä¹Ÿæ˜¯ Java å†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸã€‚ â— Java å †åŒºåœ¨ JVM å¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»ºï¼Œå…¶ç©ºé—´å¤§å°ä¹Ÿå°±ç¡®å®šäº†ã€‚æ˜¯ JVM ç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜ç©ºé—´ã€‚ â¢ å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒèŠ‚çš„ã€‚   â— ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šï¼Œå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚ â— æ‰€æœ‰çš„çº¿ç¨‹å…±äº« Java å †ï¼Œåœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM 04 è¿è¡Œæ—¶æ•°æ®åŒºä¹‹å † (Heap)">
<meta property="og:url" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/index.html">
<meta property="og:site_name" content="ç©ºåŸç›¼æ•…äºº">
<meta property="og:description" content="1 å †çš„æ ¸å¿ƒæ¦‚è¿° â— ä¸€ä¸ª JVM å®ä¾‹åªå­˜åœ¨ä¸€ä¸ªå †å†…å­˜ï¼Œå †ä¹Ÿæ˜¯ Java å†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸã€‚ â— Java å †åŒºåœ¨ JVM å¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»ºï¼Œå…¶ç©ºé—´å¤§å°ä¹Ÿå°±ç¡®å®šäº†ã€‚æ˜¯ JVM ç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜ç©ºé—´ã€‚ â¢ å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒèŠ‚çš„ã€‚   â— ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šï¼Œå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚ â— æ‰€æœ‰çš„çº¿ç¨‹å…±äº« Java å †ï¼Œåœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/%E5%A0%86%E7%A9%BA%E9%97%B4%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/%E6%B0%B8%E4%B9%85%E4%BB%A3%E5%92%8C%E5%85%83%E7%A9%BA%E9%97%B4.jpeg">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/HeapDemo0.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/HeapDemo.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/HeapDemo1.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/SimpleHeap.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/VisualVM.gif">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/VisualVMSampler.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/HeapMemoryDivision.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/Survivor.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/%E6%96%B0%E7%94%9F%E4%BB%A3%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/VisualVMVisualGC.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/TLAB.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/StackAllocation1.png">
<meta property="og:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/StackAllocation2.png">
<meta property="article:published_time" content="2020-07-11T09:02:59.000Z">
<meta property="article:modified_time" content="2022-08-26T08:30:08.252Z">
<meta property="article:author" content="è®¸åµ©è€å…¬">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xiaoyan94.github.io/2020/07/11/JVM-04/%E5%A0%86%E7%A9%BA%E9%97%B4%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84.png">
  
    <link rel="alternate" href="../../../../atom.xml" title="ç©ºåŸç›¼æ•…äºº" type="application/atom+xml">
  
  
    <link rel="icon" href="https://q1.qlogo.cn/g?b=qq&nk=979727728&s=640">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="../../../../css/style.css">

  
<link rel="stylesheet" href="../../../../css/highlight.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="fullpage" class="mobile-nav-right">
    <div class="fixed"></div>
    
      <div id="wrapper">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="../../../../index.html" title
        
        >é¦–é¡µ</a>
      
        <a class="nav-item" href="../../../../archives" title
        
        >å½’æ¡£</a>
      
        <a class="nav-item" href="../../../../quick-notes" title
        
        >å°æŠ„</a>
      
        <a class="nav-item" href="../../../../about" title
        
        >å…³äº</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main"><article id="post-JVM-04" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      JVM 04 è¿è¡Œæ—¶æ•°æ®åŒºä¹‹å † (Heap)
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2020-07-11T09:02:59.000Z" itemprop="datePublished">2020-07-11</time>
</a>
    
    
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/JVM/" rel="tag">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Java/" rel="tag">Java</a></li></ul>

  </div>
  
    <span id="busuanzi_container_page_pv">
      æœ¬æ–‡æ€»é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>æ¬¡
    </span>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        
        <h2 id="1-å †çš„æ ¸å¿ƒæ¦‚è¿°"><a href="#1-å †çš„æ ¸å¿ƒæ¦‚è¿°" class="headerlink" title="1 å †çš„æ ¸å¿ƒæ¦‚è¿°"></a>1 å †çš„æ ¸å¿ƒæ¦‚è¿°</h2><ul>
<li>â— ä¸€ä¸ª JVM å®ä¾‹åªå­˜åœ¨ä¸€ä¸ªå †å†…å­˜ï¼Œå †ä¹Ÿæ˜¯ Java å†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸã€‚</li>
<li>â— Java å †åŒºåœ¨ JVM å¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»ºï¼Œå…¶ç©ºé—´å¤§å°ä¹Ÿå°±ç¡®å®šäº†ã€‚æ˜¯ JVM ç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜ç©ºé—´ã€‚<ul>
<li>â¢ å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒèŠ‚çš„ã€‚</li>
</ul>
</li>
<li>â— ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šï¼Œå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚</li>
<li>â— æ‰€æœ‰çš„çº¿ç¨‹å…±äº« Java å †ï¼Œåœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒº (ThreadLocal Allocation Bufferï¼Œ TLAB)</li>
</ul>
<p>ä¸€ä¸ª JVM å®ä¾‹å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œæ–¹æ³•åŒºå’Œå †æ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸€ä»½ï¼Œè€Œç¨‹åºè®¡æ•°å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆã€è™šæ‹Ÿæœºæ ˆæ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä»½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«æ–¹æ³•åŒºå’Œå †ï¼ˆå¹¶ä¸æ˜¯å®Œæ•´çš„å †éƒ½ä¸€å®šæ˜¯å…±äº«çš„ï¼Œæ¯”å¦‚ TLABï¼‰ã€‚</p>
<a id="more"></a>

<ul>
<li><a href="#1-å †çš„æ ¸å¿ƒæ¦‚è¿°">1 å †çš„æ ¸å¿ƒæ¦‚è¿°</a><ul>
<li><a href="#å†…å­˜ç»†åˆ†">å†…å­˜ç»†åˆ†</a></li>
</ul>
</li>
<li><a href="#2-è®¾ç½®å †å†…å­˜å¤§å°ä¸-OOM">2 è®¾ç½®å †å†…å­˜å¤§å°ä¸ OOM</a><ul>
<li><a href="#å †ç©ºé—´å¤§å°çš„è®¾ç½®">å †ç©ºé—´å¤§å°çš„è®¾ç½®</a></li>
<li><a href="#OutOfMemoryError-çš„è¯´æ˜ä¸ä¸¾ä¾‹"><code>OutOfMemoryError</code> çš„è¯´æ˜ä¸ä¸¾ä¾‹</a></li>
</ul>
</li>
<li><a href="#3-å¹´è½»ä»£ä¸è€å¹´ä»£">3 å¹´è½»ä»£ä¸è€å¹´ä»£</a></li>
<li><a href="#4-å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹">4 å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹</a></li>
<li><a href="#5-Minor-GC-å’Œ-Major-GC-å’Œ-Full-GC">5 Minor GC å’Œ Major GC å’Œ Full GC</a><ul>
<li><a href="#æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶">æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶</a></li>
<li><a href="#GCä¸¾ä¾‹ä¸æ—¥å¿—åˆ†æ">GCä¸¾ä¾‹ä¸æ—¥å¿—åˆ†æ</a></li>
</ul>
</li>
<li><a href="#6-å †ç©ºé—´åˆ†ä»£æ€æƒ³">6 å †ç©ºé—´åˆ†ä»£æ€æƒ³</a></li>
<li><a href="#7-å†…å­˜åˆ†é…ç­–ç•¥">7 å†…å­˜åˆ†é…ç­–ç•¥</a></li>
<li><a href="#8-ä¸ºå¯¹è±¡åˆ†é…å†…å­˜TLAB">8 ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB</a></li>
<li><a href="#9-å°ç»“å †ç©ºé—´çš„å‚æ•°è®¾ç½®">9 å°ç»“å †ç©ºé—´çš„å‚æ•°è®¾ç½®</a></li>
<li><a href="#X-å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å—">X å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å—</a><ul>
<li><a href="#é€ƒé€¸åˆ†ææ¦‚è¿°">é€ƒé€¸åˆ†ææ¦‚è¿°</a></li>
<li><a href="#é€ƒé€¸åˆ†æä¹‹ä»£ç ä¼˜åŒ–">é€ƒé€¸åˆ†æä¹‹ä»£ç ä¼˜åŒ–</a><ul>
<li><a href="#ä»£ç ä¼˜åŒ–ä¹‹æ ˆä¸Šåˆ†é…">ä»£ç ä¼˜åŒ–ä¹‹æ ˆä¸Šåˆ†é…</a></li>
<li><a href="#ä»£ç ä¼˜åŒ–ä¹‹åŒæ­¥çœç•¥æ¶ˆé™¤">ä»£ç ä¼˜åŒ–ä¹‹åŒæ­¥çœç•¥ï¼ˆæ¶ˆé™¤ï¼‰</a></li>
<li><a href="#-ä»£ç ä¼˜åŒ–ä¹‹æ ‡é‡æ›¿æ¢">ğŸŒ¿ ä»£ç ä¼˜åŒ–ä¹‹æ ‡é‡æ›¿æ¢</a></li>
<li><a href="#é€ƒé€¸åˆ†æå°ç»“">é€ƒé€¸åˆ†æå°ç»“</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#æœ¬ç« å°ç»“">æœ¬ç« å°ç»“</a></li>
</ul>
<h3 id="å†…å­˜ç»†åˆ†"><a href="#å†…å­˜ç»†åˆ†" class="headerlink" title="å†…å­˜ç»†åˆ†"></a>å†…å­˜ç»†åˆ†</h3><p>ç°ä»£åƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†éƒ½åŸºäºåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡ï¼Œå †ç©ºé—´ç»†åˆ†ä¸ºï¼š</p>
<p>Java 7 åŠä¹‹å‰å †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”ŸåŒº + å…»è€åŒº +<strong>æ°¸ä¹…åŒº</strong></p>
<ul>
<li>â¢ Young Generation Space æ–°ç”ŸåŒº Young/New  <ul>
<li>åˆè¢«åˆ’åˆ†ä¸º Eden åŒºå’Œ Survivor åŒº</li>
</ul>
</li>
<li>â¢ Tenure generation space å…»è€åŒº 0ld/Tenure</li>
<li>â¢ Permanent Space æ°¸ä¹…åŒº Perm</li>
</ul>
<p>Java 8 åŠä¹‹åå †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”ŸåŒº + å…»è€åŒº +<strong>å…ƒç©ºé—´</strong></p>
<ul>
<li>â¢ Young Generation Space æ–°ç”ŸåŒº Young/New<ul>
<li>åˆè¢«åˆ’åˆ†ä¸º Eden åŒºå’Œ Survivor åŒº</li>
</ul>
</li>
<li>â¢ Tenure generation space å…»è€åŒº 0ld/Tenure</li>
<li>â¢ Meta Space å…ƒç©ºé—´ Meta</li>
</ul>
<p>çº¦å®šï¼šæ–°ç”ŸåŒº / æ–°ç”Ÿä»£ / å¹´è½»ä»£ã€å…»è€åŒº / è€å¹´åŒº / è€å¹´ä»£ã€æ°¸ä¹…åŒº / æ°¸ä¹…ä»£</p>
<p><img src="/2020/07/11/JVM-04/%E5%A0%86%E7%A9%BA%E9%97%B4%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84.png" alt="å †ç©ºé—´å†…éƒ¨ç»“æ„"></p>
<p><img src="/2020/07/11/JVM-04/%E6%B0%B8%E4%B9%85%E4%BB%A3%E5%92%8C%E5%85%83%E7%A9%BA%E9%97%B4.jpeg" alt="æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´"></p>
<p>æ¼”ç¤º JVM å®ä¾‹ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms10m -Xmx10m</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  16:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        System.out.println (<span class="string">"start..."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep (<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println (<span class="string">"end..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<hr>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms20m -Xmx20m</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  16:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapDemo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        System.out.println (<span class="string">"start..."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep (<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println (<span class="string">"end..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ Idea ä¸­ï¼Œä¾æ¬¡ç‚¹å‡» <code>Run</code> - <code>Edit Configurations</code> åœ¨ <code>VM options</code> ä¸­è¾“å…¥å‚æ•° <code>-Xms20m -Xmx20m</code>ã€‚ç„¶åæ‰“å¼€ <a href="https://visualvm.github.io/" target="_blank" rel="noopener">Visual VM</a>ï¼Œè¿™ä¸ªè½¯ä»¶åœ¨ JDK 1.8 ä»¥åå°±ä¸å†å†…ç½®ï¼Œéœ€è¦ <a href="https://visualvm.github.io/download.html" target="_blank" rel="noopener">æ‰‹åŠ¨ä¸‹è½½</a>ï¼Œ åœ¨ <code>Tools</code> - <code>Plugins</code> ä¸­å®‰è£… <code>Visual GC</code> æ’ä»¶ã€‚</p>
<p><img src="/2020/07/11/JVM-04/HeapDemo0.png" alt="HeapDemo Overview"></p>
<p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°è®¾ç½®çš„ JVM å†…å­˜å‚æ•°ã€‚</p>
<p><img src="/2020/07/11/JVM-04/HeapDemo.png" alt="HeapDemo"></p>
<p><img src="/2020/07/11/JVM-04/HeapDemo1.png" alt="HeapDemo1"></p>
<p>ä»ä»¥ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œï¼ˆJDK1.8 ä¸‹è¿è¡Œæ—¶ï¼‰ä¼Šç”¸å›­åŒºã€<strong>ä¸¤ä¸ªå¹¸å­˜è€…åŒº</strong>ã€è€å¹´åŒºåŠ èµ·æ¥æ­£å¥½æ˜¯æˆ‘ä»¬è®¾ç½®çš„æ€»å†…å­˜å¤§å° 20Mã€‚ï¼ˆå®æµ‹JDK1.7 ä¸‹è¿è¡Œæ—¶ï¼Œä¼Šç”¸å›­åŒºã€<em>ä¸€ä¸ªå¹¸å­˜è€…åŒº</em>ã€è€å¹´åŒºåŠ èµ·æ¥æ˜¯ 20Mï¼‰</p>
<hr>
<ul>
<li>ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¯¹ Java å †çš„æè¿°æ˜¯ï¼šæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åº”å½“åœ¨è¿è¡Œæ—¶åˆ†é…åœ¨å †ä¸Šã€‚(The heap is the run-time data area from which memory for all class instances and arrays is allocated )<ul>
<li>â¢ æˆ‘è¦è¯´çš„æ˜¯ï¼šâ€œå‡ ä¹â€ æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚â€”â€” ä»å®é™…ä½¿ç”¨è§’åº¦çœ‹çš„ã€‚</li>
</ul>
</li>
<li>æ•°ç»„å’Œå¯¹è±¡å¯èƒ½æ°¸è¿œä¸ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œå› ä¸ºæ ˆå¸§ä¸­ä¿å­˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘å¯¹è±¡æˆ–è€…æ•°ç»„åœ¨å †ä¸­çš„ä½ç½®ã€‚</li>
<li>åœ¨æ–¹æ³•ç»“æŸåï¼Œå †ä¸­çš„å¯¹è±¡ä¸ä¼šé©¬ä¸Šè¢«ç§»é™¤ï¼Œä»…ä»…åœ¨åƒåœ¾æ”¶é›†çš„æ—¶å€™æ‰ä¼šè¢«ç§»é™¤ã€‚</li>
<li>å †ï¼Œæ˜¯ GC ( Garbage Collection, åƒåœ¾æ”¶é›†å™¨ï¼‰æ‰§è¡Œåƒåœ¾å›æ”¶çš„é‡ç‚¹åŒºåŸŸã€‚</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  17:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHeap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;<span class="comment">// å±æ€§ã€æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleHeap</span> <span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println (<span class="string">"My ID is"</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        SimpleHeap sl = <span class="keyword">new</span> SimpleHeap (<span class="number">1</span>);</span><br><span class="line">        SimpleHeap s2 = <span class="keyword">new</span> SimpleHeap (<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> [] arr = <span class="keyword">new</span> <span class="keyword">int</span> [<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">        Object [] arr1 = <span class="keyword">new</span> Object [<span class="number">10</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è®¾ç½® VM å‚æ•°ï¼š<code>-Xms10m -Xmx10m -XX:+PrintGCDetails</code> , åœ¨ JDK1.8 ä¸‹è¿è¡Œ SimpleHeap</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">2560</span>K, used <span class="number">1406</span>K [<span class="number">0x00000007bfd00000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">2048</span>K, <span class="number">68</span>% used [<span class="number">0x00000007bfd00000</span>,<span class="number">0x00000007bfe5fbe8</span>,<span class="number">0x00000007bff00000</span>)</span><br><span class="line">  from space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff80000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">7168</span>K, used <span class="number">0</span>K [<span class="number">0x00000007bf600000</span>, <span class="number">0x00000007bfd00000</span>, <span class="number">0x00000007bfd00000</span>)</span><br><span class="line">  object space <span class="number">7168</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bf600000</span>,<span class="number">0x00000007bf600000</span>,<span class="number">0x00000007bfd00000</span>)</span><br><span class="line"> Metaspace       used <span class="number">2950</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 320<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure></div>

<p>åœ¨ JDK1.7 ä¸‹è¿è¡Œï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">3072</span>K, used <span class="number">1176</span>K [<span class="number">0x00000007ffc80000</span>, <span class="number">0x0000000800000000</span>, <span class="number">0x0000000800000000</span>)</span><br><span class="line">  eden space <span class="number">2560</span>K, <span class="number">45</span>% used [<span class="number">0x00000007ffc80000</span>,<span class="number">0x00000007ffda6258</span>,<span class="number">0x00000007fff00000</span>)</span><br><span class="line">  from space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000007fff80000</span>,<span class="number">0x00000007fff80000</span>,<span class="number">0x0000000800000000</span>)</span><br><span class="line">  to   space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000007fff00000</span>,<span class="number">0x00000007fff00000</span>,<span class="number">0x00000007fff80000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">7168</span>K, used <span class="number">0</span>K [<span class="number">0x00000007ff580000</span>, <span class="number">0x00000007ffc80000</span>, <span class="number">0x00000007ffc80000</span>)</span><br><span class="line">  object space <span class="number">7168</span>K, <span class="number">0</span>% used [<span class="number">0x00000007ff580000</span>,<span class="number">0x00000007ff580000</span>,<span class="number">0x00000007ffc80000</span>)</span><br><span class="line"> PSPermGen       total <span class="number">21504</span>K, used <span class="number">2859</span>K [<span class="number">0x00000007fa380000</span>, <span class="number">0x00000007fb880000</span>, <span class="number">0x00000007ff580000</span>)</span><br><span class="line">  object space <span class="number">21504</span>K, <span class="number">13</span>% used [<span class="number">0x00000007fa380000</span>,<span class="number">0x00000007fa64af68</span>,<span class="number">0x00000007fb880000</span>)</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒJDK1.8 ä»¥åå°±æ˜¯å…ƒç©ºé—´äº†ã€‚</p>
<p><img src="/2020/07/11/JVM-04/SimpleHeap.png" alt="å±€éƒ¨å˜é‡è¡¨ã€å †ã€æ–¹æ³•åŒº"></p>
<p>å¯¹è±¡ã€æ•°ç»„åœ¨å †ä¸­åˆ›å»ºï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­åªä¿ç•™å¯¹ä»–ä»¬çš„å¼•ç”¨ã€‚</p>
<hr>
<h2 id="2-è®¾ç½®å †å†…å­˜å¤§å°ä¸-OOM"><a href="#2-è®¾ç½®å †å†…å­˜å¤§å°ä¸-OOM" class="headerlink" title="2 è®¾ç½®å †å†…å­˜å¤§å°ä¸ OOM"></a>2 è®¾ç½®å †å†…å­˜å¤§å°ä¸ OOM</h2><h3 id="å †ç©ºé—´å¤§å°çš„è®¾ç½®"><a href="#å †ç©ºé—´å¤§å°çš„è®¾ç½®" class="headerlink" title="å †ç©ºé—´å¤§å°çš„è®¾ç½®"></a>å †ç©ºé—´å¤§å°çš„è®¾ç½®</h3><ul>
<li>Java å †åŒºç”¨äºå­˜å‚¨ Java å¯¹è±¡å®ä¾‹ï¼Œé‚£ä¹ˆå †çš„å¤§å°åœ¨ JVM å¯åŠ¨æ—¶å°±å·²ç»è®¾å®šå¥½äº†ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡é€‰é¡¹ â€œ<code>-Xmx</code>â€œ å’Œâ€<code>-Xms</code>â€œ æ¥è¿›è¡Œè®¾ç½®ã€‚<ul>
<li>â¢â€œ<code>-Xms</code>â€œ ç”¨äºè¡¨ç¤ºå †åŒºçš„èµ·å§‹å†…å­˜ï¼Œç­‰ä»·äº <code>-XX: InitialHeapSize</code></li>
<li>â¢â€œ<code>-Xmx</code>â€œ åˆ™ç”¨äºè¡¨ç¤ºå †åŒºçš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äº <code>-XX :MaxHeapSize</code></li>
</ul>
</li>
<li>ä¸€æ—¦å †åŒºä¸­çš„å†…å­˜å¤§å°è¶…è¿‡ â€œ<code>-Xmx</code>â€œ æ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°†ä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</li>
<li>é€šå¸¸ä¼šå°† <code>-Xms</code> å’Œ <code>-Xmx</code> ä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒçš„å€¼ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ java åƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 64</li>
<li>æœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 4</li>
</ul>
<p><code>-X</code> å‚æ•°ç”¨æ³•ï¼š<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. è®¾ç½®å †ç©ºé—´å¤§å°çš„å‚æ•°</span></span><br><span class="line"><span class="comment"> * -Xms ç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆå¹´è½»ä»£ + è€å¹´ä»£ï¼‰çš„åˆå§‹å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment"> *      -X æ˜¯ jvm çš„è¿è¡Œå‚æ•°</span></span><br><span class="line"><span class="comment"> *      ms æ˜¯ memory start</span></span><br><span class="line"><span class="comment"> * -Xmx ç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆå¹´è½»ä»£ + è€å¹´ä»£ï¼‰çš„æœ€å¤§å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2. é»˜è®¤å †ç©ºé—´çš„å¤§å°</span></span><br><span class="line"><span class="comment"> *    åˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 64</span></span><br><span class="line"><span class="comment"> *             æœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 4</span></span><br><span class="line"><span class="comment"> * 3. æ‰‹åŠ¨è®¾ç½®ï¼š-Xms600m -Xmx600m</span></span><br><span class="line"><span class="comment"> *     å¼€å‘ä¸­å»ºè®®å°†åˆå§‹å †å†…å­˜å’Œæœ€å¤§çš„å †å†…å­˜è®¾ç½®æˆç›¸åŒçš„å€¼ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4. æŸ¥çœ‹è®¾ç½®çš„å‚æ•°ï¼šæ–¹å¼ä¸€ï¼š jps   /  jstat -gc è¿›ç¨‹ id</span></span><br><span class="line"><span class="comment"> *                  æ–¹å¼äºŒï¼š-XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  20:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSpaceInitial</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å› Java è™šæ‹Ÿæœºä¸­çš„å †å†…å­˜æ€»é‡</span></span><br><span class="line">        <span class="keyword">long</span> initialMemory = Runtime.getRuntime ().totalMemory () / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line">        <span class="comment">// è¿”å› Java è™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å †å†…å­˜é‡</span></span><br><span class="line">        <span class="keyword">long</span> maxMemory = Runtime.getRuntime ().maxMemory () / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println (<span class="string">"-Xms :"</span> + initialMemory + <span class="string">"M"</span>);</span><br><span class="line">        System.out.println (<span class="string">"-Xmx :"</span> + maxMemory + <span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é»˜è®¤è®¾ç½®æ—¶ï¼Œå³ä¸è®¾ç½®è™šæ‹Ÿæœºå‚æ•°ä½¿ç”¨é»˜è®¤åˆ†é…å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment">//        System.out.println ("ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š" + initialMemory * 64.0 / 1024 + "G");</span></span><br><span class="line"><span class="comment">//        System.out.println ("ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š" + maxMemory * 4.0 / 1024 + "G");</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep (<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç¨‹åºè¾“å‡ºï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms : <span class="number">575</span>M</span><br><span class="line">-Xmx : <span class="number">575</span>M</span><br></pre></td></tr></table></figure></div>

<p>ä¸ºä»€ä¹ˆè¾“å‡ºç»“æœä¸æ˜¯è®¾ç½®çš„ 600Mï¼Ÿ</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> ï£¿ jps</span><br><span class="line">32736</span><br><span class="line">49124 Launcher</span><br><span class="line">49125 HeapSpaceInitial</span><br><span class="line">49161 Jps</span><br><span class="line">34013 Main</span><br><span class="line"> ï£¿ jstat -gc 49125</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT</span><br><span class="line">25600.0 25600.0  0.0    0.0   153600.0 15360.5   409600.0     0.0     4480.0 780.7  384.0   76.6       0    0.000   0      0.000   -          -    0.000</span><br></pre></td></tr></table></figure></div>

<p>é€šè¿‡ä¸‹é¢ä¸¤ä¸ªæŸ¿å­ï¼š</p>
<ol>
<li>25600 (S0C) + 25600 (S1C) + 153600 (EC) + 409600 (OC) = 614400, 614400 Ã· 1024 = 600</li>
<li>25600 (S0C/S1C) + 153600 (EC) + 409600 (OC) = 588800, 588800 Ã· 1024 = 575</li>
</ol>
<p>å¯çŸ¥ï¼Œ575 ä¸ºä¸¤ä¸ªå¹¸å­˜è€…åŒºå…¶ä¸­ä¸€ä¸ªå¹¸å­˜è€…åŒº + ä¼Šç”¸å›­åŒº + è€å¹´åŒºçš„å¤§å°æ€»å’Œã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>-XX:+PrintGCDetails</code> æŸ¥çœ‹ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-Xms : <span class="number">575</span>M</span><br><span class="line">-Xmx : <span class="number">575</span>M</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">179200</span>K, used <span class="number">9216</span>K [<span class="number">0x00000007b3800000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">153600</span>K, <span class="number">6</span>% used [<span class="number">0x00000007b3800000</span>,<span class="number">0x00000007b41001a0</span>,<span class="number">0x00000007bce00000</span>)</span><br><span class="line">  from space <span class="number">25600</span>K, <span class="number">0</span>% used [<span class="number">0x00000007be700000</span>,<span class="number">0x00000007be700000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">25600</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bce00000</span>,<span class="number">0x00000007bce00000</span>,<span class="number">0x00000007be700000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">409600</span>K, used <span class="number">0</span>K [<span class="number">0x000000079a800000</span>, <span class="number">0x00000007b3800000</span>, <span class="number">0x00000007b3800000</span>)</span><br><span class="line">  object space <span class="number">409600</span>K, <span class="number">0</span>% used [<span class="number">0x000000079a800000</span>,<span class="number">0x000000079a800000</span>,<span class="number">0x00000007b3800000</span>)</span><br><span class="line"> Metaspace       used <span class="number">2953</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 321<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure></div>

<p>179200K = 153600K + 25600K ï¼Œå¹´è½»ä»£æ€»å¤§å°ä¸ºä¼Šç”¸å›­åŒº + ä¸€ä¸ªå¹¸å­˜è€… (from æˆ– to) åŒºçš„å¤§å°ã€‚</p>
<h3 id="OutOfMemoryError-çš„è¯´æ˜ä¸ä¸¾ä¾‹"><a href="#OutOfMemoryError-çš„è¯´æ˜ä¸ä¸¾ä¾‹" class="headerlink" title="OutOfMemoryError çš„è¯´æ˜ä¸ä¸¾ä¾‹"></a><code>OutOfMemoryError</code> çš„è¯´æ˜ä¸ä¸¾ä¾‹</h3><p>æ¼”ç¤ºç¨‹åºï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms600m -Xmx600m</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  21:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;Picture&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep (<span class="number">20</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace ();</span><br><span class="line">            &#125;</span><br><span class="line">            list.add (<span class="keyword">new</span> Picture (<span class="keyword">new</span> Random ().nextInt (<span class="number">1024</span> * <span class="number">1024</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Picture</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span> [] pixels;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Picture</span> <span class="params">(<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pixels = <span class="keyword">new</span> <span class="keyword">byte</span> [length];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç¨‹åºæœ€ç»ˆè‚¯å®šä¼šè¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">  at com.atguigu.java.Picture.&lt;init&gt;(OOMTest.java:<span class="number">29</span>)</span><br><span class="line">  at com.atguigu.java.OOMTest.main (OOMTest.java:<span class="number">20</span>)</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ Visual VM ä¸­ï¼Œé€šè¿‡ Visual GC å¯ä»¥åŠ¨æ€ç›‘æ§å †å†…å­˜å˜åŒ–æƒ…å†µï¼Œé€šè¿‡ Sampler - Memory è¿˜å¯ä»¥åˆ†ææ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´å †å†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p>
<p><img src="/2020/07/11/JVM-04/VisualVM.gif" alt="VisualVM - Visual GC"><br><img src="/2020/07/11/JVM-04/VisualVMSampler.png" alt="VisualVM - Sampler - Memory"></p>
<hr>
<h2 id="3-å¹´è½»ä»£ä¸è€å¹´ä»£"><a href="#3-å¹´è½»ä»£ä¸è€å¹´ä»£" class="headerlink" title="3 å¹´è½»ä»£ä¸è€å¹´ä»£"></a>3 å¹´è½»ä»£ä¸è€å¹´ä»£</h2><ul>
<li>å­˜å‚¨åœ¨ JVM ä¸­çš„ Java å¯¹è±¡å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ç±»ï¼š<ul>
<li>â¢ ä¸€ç±»æ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„ç¬æ—¶å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡çš„åˆ›å»ºå’Œæ¶ˆäº¡éƒ½éå¸¸è¿…é€Ÿ</li>
<li>â¢ å¦å¤–ä¸€ç±»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå´éå¸¸é•¿ï¼Œåœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹è¿˜èƒ½å¤Ÿä¸ JVM çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</li>
</ul>
</li>
<li>Java å †åŒºè¿›ä¸€æ­¥ç»†åˆ†çš„è¯ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå¹´è½»ä»£ (YoungGen) å’Œè€å¹´ä»£ (OldGen)</li>
<li>å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥åˆ’åˆ†ä¸º Eden ç©ºé—´ã€Survivor0 ç©ºé—´å’Œ Survivor1 ç©ºé—´ï¼ˆæœ‰æ—¶ä¹Ÿå«åš from åŒºã€to åŒºï¼‰ã€‚</li>
</ul>
<p><img src="/2020/07/11/JVM-04/HeapMemoryDivision.png" alt="å †ç©ºé—´å†…éƒ¨ç»“æ„åˆ’åˆ†"></p>
<p>ä¸‹é¢è¿™å‚æ•°å¼€å‘ä¸­ä¸€èˆ¬ä¸ä¼šè°ƒï¼š</p>
<p>é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”ã€‚</p>
<ul>
<li>â¢ é»˜è®¤ <code>-XX:NewRatio=2</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å  1ï¼Œè€å¹´ä»£å  2ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„ 1/3</li>
<li>â¢ å¯ä»¥ä¿®æ”¹ <code>-XX:NewRatio=4</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å  1ï¼Œè€å¹´ä»£å  4ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„ 1/5</li>
</ul>
<p>æµ‹è¯•ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms600m -Xmx600m</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * -XX:NewRatio ï¼š è®¾ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ã€‚é»˜è®¤å€¼æ˜¯ 2.</span></span><br><span class="line"><span class="comment"> * -XX:SurvivorRatio ï¼šè®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden åŒºä¸ Survivor åŒºçš„æ¯”ä¾‹ã€‚é»˜è®¤å€¼æ˜¯ 8</span></span><br><span class="line"><span class="comment"> * -XX:-UseAdaptiveSizePolicy ï¼šå…³é—­è‡ªé€‚åº”çš„å†…å­˜åˆ†é…ç­–ç•¥  ï¼ˆæš‚æ—¶ç”¨ä¸åˆ°ï¼‰</span></span><br><span class="line"><span class="comment"> * -Xmn: è®¾ç½®æ–°ç”Ÿä»£çš„ç©ºé—´çš„å¤§å°ã€‚ ï¼ˆä¸€èˆ¬ä¸è®¾ç½®ï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  17:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EdenSurvivorTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        System.out.println (<span class="string">"æˆ‘åªæ˜¯æ¥æ‰“ä¸ªé…±æ²¹ï½"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep (<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è®¾ç½® VM Option å‚æ•°ï¼š<code>-Xms600m -Xmx600m</code> ï¼Œå¯ä»¥ä½¿ç”¨ <code>jinfo</code> å‘½ä»¤æŸ¥çœ‹ <code>NewRatio</code> å‚æ•°ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ ï£¿ yan î‚° ~ î‚° jps <span class="comment">#jps</span></span><br><span class="line">32736</span><br><span class="line">34013 Main</span><br><span class="line">53645 Launcher</span><br><span class="line">54110 Jps</span><br><span class="line">53646 EdenSurvivorTest</span><br><span class="line"> ï£¿ yan î‚° ~ î‚° jinfo -flag NewRatio 53646 <span class="comment">#jinfo</span></span><br><span class="line">-XX:NewRatio=2</span><br><span class="line"> ï£¿ yan î‚° ~ î‚° jinfo -flag SurvivorRatio 53646</span><br><span class="line">-XX:SurvivorRatio=8</span><br></pre></td></tr></table></figure></div>

<p>ä½¿ç”¨ä¸åŒçš„å‚æ•°è¿è¡Œç¨‹åºè¿›è¡Œæµ‹è¯•ï¼Œå¾—åˆ°ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>Eden Space</th>
<th>Survivor 0</th>
<th>Survivor 1</th>
<th>Old Gen</th>
<th>SurvivorRatio</th>
<th>NewRatio</th>
</tr>
</thead>
<tbody><tr>
<td><code>-Xms600m -Xmx600m</code></td>
<td>150</td>
<td>25</td>
<td>25</td>
<td>400</td>
<td>6</td>
<td>2</td>
</tr>
<tr>
<td><code>-Xms600m -Xmx600m -XX:-UseAdaptiveSizePolicy</code></td>
<td>150</td>
<td>25</td>
<td>25</td>
<td>400</td>
<td>6</td>
<td>2</td>
</tr>
<tr>
<td><code>-Xms600m -Xmx600m -XX:SurvivorRatio=8</code></td>
<td>160</td>
<td>20</td>
<td>20</td>
<td>400</td>
<td>8</td>
<td>2</td>
</tr>
<tr>
<td><code>-Xms600m -Xmx600m -XX:SurvivorRatio=8 -XX:NewRatio=3</code></td>
<td>120</td>
<td>15</td>
<td>15</td>
<td>450</td>
<td>8</td>
<td>3</td>
</tr>
</tbody></table>
<p>è™½ç„¶é»˜è®¤çš„ <code>SurvivorRatio</code> æ˜¯ 8ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿæ˜¯ 8ï¼Œä½†æ˜¯å®é™…è¿è¡Œä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…åŒºçš„æ¯”ä¾‹æ˜¯ 150:25 = 6:1ï¼Œå³ä½¿ä½¿ç”¨ <code>-XX:-UseAdaptiveSizePolicy</code> ï¼šå…³é—­è‡ªé€‚åº”çš„å†…å­˜åˆ†é…ç­–ç•¥ï¼Œä¹Ÿè¿˜æ˜¯ 6:1ã€‚é™¤éæ˜¾å¼åœ°ä½¿ç”¨ <code>-XX:SurvivorRatio=8</code> æ˜¾å¼æŒ‡å®šæ¯”ä¾‹ä¸º 8:1</p>
<ul>
<li>åœ¨ HotSpot ä¸­ï¼ŒEden ç©ºé—´å’Œå¦å¤–ä¸¤ä¸ª Survivor ç©ºé—´ç¼ºçœæ‰€å çš„æ¯”ä¾‹æ˜¯ 8:1:1</li>
<li>å½“ç„¶å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹ â€œ<code>-XX:SurvivorRatio</code>â€œ è°ƒæ•´è¿™ä¸ªç©ºé—´æ¯”ä¾‹ã€‚æ¯”å¦‚ <code>-XX:SurvivorRatio=8</code></li>
<li><strong>å‡ ä¹æ‰€æœ‰</strong> çš„ Java å¯¹è±¡éƒ½æ˜¯åœ¨ Eden åŒºè¢« new å‡ºæ¥çš„ã€‚</li>
<li>ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡çš„é”€æ¯éƒ½åœ¨æ–°ç”Ÿä»£è¿›è¡Œäº†ã€‚<ul>
<li>â¢ IBM å…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­ 80% çš„å¯¹è±¡éƒ½æ˜¯ â€œæœç”Ÿå¤•æ­»â€ çš„ã€‚</li>
</ul>
</li>
<li>å¯ä»¥ä½¿ç”¨é€‰é¡¹ â€œ<code>-Xmn</code>â€œ è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å†…å­˜å¤§å°</li>
<li>â¢è¿™ä¸ªå‚æ•°ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚</li>
</ul>
<p><img src="/2020/07/11/JVM-04/Survivor.png" alt="å¹´è½»ä»£ä¸è€å¹´ä»£çš„å…³ç³»"></p>
<p><a href="Plumbr%20Handbook%20Java%20Garbage%20Collection.pdf">å‚è€ƒæ–‡æ¡£ï¼šPlumbr Handbook Java Garbage Collection.pdf</a></p>
<hr>
<h2 id="4-å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹"><a href="#4-å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹" class="headerlink" title="4 å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹"></a>4 å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹</h2><p>ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ˜¯ä¸€ä»¶éå¸¸ä¸¥è°¨å’Œå¤æ‚çš„ä»»åŠ¡ï¼ŒJVM çš„è®¾è®¡è€…ä»¬ä¸ä»…éœ€è¦è€ƒè™‘å†…å­˜å¦‚ä½•åˆ†é…ã€åœ¨å“ªé‡Œåˆ†é…ç­‰é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºå†…å­˜åˆ†é…ç®—æ³•ä¸å†…å­˜å›æ”¶ç®—æ³•å¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥è¿˜éœ€è¦è€ƒè™‘ GC æ‰§è¡Œå®Œå†…å­˜å›æ”¶åæ˜¯å¦ä¼šåœ¨å†…å­˜ç©ºé—´ä¸­äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p>
<ol>
<li>new çš„å¯¹è±¡å…ˆæ”¾ä¼Šç”¸å›­åŒºã€‚æ­¤åŒºæœ‰å¤§å°é™åˆ¶ã€‚</li>
<li>å½“ä¼Šç”¸å›­çš„ç©ºé—´å¡«æ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVM çš„åƒåœ¾å›æ”¶å™¨å°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ (Minor GC)ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­çš„ä¸å†è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ã€‚å†åŠ è½½æ–°çš„å¯¹è±¡æ”¾åˆ°ä¼Šç”¸å›­åŒºã€‚</li>
<li>ç„¶åå°†ä¼Šç”¸å›­åŒºä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€… 0 åŒºã€‚</li>
<li>å¦‚æœå†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€… 0 åŒºçš„ï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€… 1 åŒºã€‚</li>
<li>å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾å›å¹¸å­˜è€… 0 åŒºï¼Œæ¥ç€å†å»å¹¸å­˜è€… 1 åŒºã€‚</li>
<li>å•¥æ—¶å€™èƒ½å»å…»è€åŒºå‘¢ï¼Ÿå¯ä»¥è®¾ç½®æ¬¡æ•°ã€‚é»˜è®¤æ˜¯ 15 æ¬¡ã€‚<ul>
<li>å¯ä»¥è®¾ç½®å‚æ•°: <code>-XX:MaxTenuringThreshold=&lt;N&gt;</code> è¿›è¡Œè®¾ç½®ã€‚</li>
</ul>
</li>
</ol>
<p><img src="/2020/07/11/JVM-04/%E6%96%B0%E7%94%9F%E4%BB%A3%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B.png" alt="æ–°ç”Ÿä»£å¯¹è±¡å†…å­˜åˆ†é…ä¸å›æ”¶è¿‡ç¨‹"></p>
<p>å½“ä¼Šç”¸å›­åŒºæ»¡çš„æ—¶å€™ï¼Œä¼šè§¦å‘ YGC/MinorGCï¼Œä¼šå°†ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…åŒº (from åŒº) ä¸€èµ·å›æ”¶ã€‚ä½†æ˜¯å¹¸å­˜è€…åŒºæ»¡çš„æ—¶å€™ä¸ä¼šè§¦å‘ YGC/MinorGCã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p><strong>é’ˆå¯¹å¹¸å­˜è€… s0ï¼Œs1 åŒºçš„æ€»ç»“ï¼šå¤åˆ¶ä¹‹åæœ‰äº¤æ¢ï¼Œè°ç©ºè°æ˜¯ to</strong>ã€‚</p>
<p><strong>å…³äºåƒåœ¾å›æ”¶ï¼šé¢‘ç¹åœ¨æ–°ç”ŸåŒºæ”¶é›†ï¼Œå¾ˆå°‘åœ¨å…»è€åŒºæ”¶é›†ï¼Œå‡ ä¹ä¸åœ¨æ°¸ä¹…åŒº / å…ƒç©ºé—´æ”¶é›†</strong>ã€‚</p>
<p>å¯¹è±¡åˆ†é…ç‰¹æ®Šæƒ…å†µï¼š</p>
<p><img src="/2020/07/11/JVM-04/%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5.png" alt="å¯¹è±¡åˆ†é…ç‰¹æ®Šæƒ…å†µ"></p>
<p>ä»£ç ä¸¾ä¾‹ä¸ JVisualVM æ¼”ç¤ºå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms600m -Xmx600m</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  17:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapInstanceTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span> [] buffer = <span class="keyword">new</span> <span class="keyword">byte</span> [<span class="keyword">new</span> Random ().nextInt (<span class="number">1024</span> * <span class="number">200</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;HeapInstanceTest&gt; list = <span class="keyword">new</span> ArrayList&lt;HeapInstanceTest&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            list.add (<span class="keyword">new</span> HeapInstanceTest ());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep (<span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace ();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>VisualVM - Visual GCï¼š</p>
<p><img src="/2020/07/11/JVM-04/VisualVMVisualGC.png" alt="æŸ¥çœ‹å¹´è½»åŒºã€è€å¹´åŒºå„æ—¶é—´æ®µå†…å­˜å ç”¨å¯¹åº”çš„å›¾åƒèµ°åŠ¿"></p>
<p>æœ€åï¼Œå †ç©ºé—´ä¸­è€å¹´åŒºæ»¡ï¼Œæ²¡æœ‰å¯ç”¨ç©ºé—´æ¥ä¸ºå¯¹è±¡ç»§ç»­åˆ†é…å†…å­˜ï¼Œç¨‹åºä¼šå¼‚å¸¸ç»ˆæ­¢ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line"> at com.atguigu.java1.HeapInstanceTest.&lt;init&gt;(HeapInstanceTest.java:<span class="number">12</span>)</span><br><span class="line"> at com.atguigu.java1.HeapInstanceTest.main (HeapInstanceTest.java:<span class="number">17</span>)</span><br></pre></td></tr></table></figure></div>

<p>å¸¸ç”¨è°ƒä¼˜å·¥å…·ï¼š</p>
<ul>
<li>JDK å‘½ä»¤è¡Œï¼š<code>jmap</code>, <code>jinfo</code>, <code>jstat</code>,<code>javap</code> ç­‰</li>
<li>Eclipse : Memory Analyzer Tool</li>
<li>Jconsole</li>
<li>VisualVM</li>
<li>Jprofiler</li>
<li>Java Flight Recorder</li>
<li>GCViewer</li>
<li>GC Easy</li>
</ul>
<p><a href="https://blog.csdn.net/wytocsdn/article/details/79258247" target="_blank" rel="noopener">åœ¨ <code>Idea</code> ä¸­é…ç½® <code>JProfiler</code></a>ï¼š</p>
<ol>
<li>å®‰è£… JProfilerï¼šå®˜ç½‘ä¸‹è½½å®‰è£… <a href="https://www.ej-technologies.com/download/jprofiler/files" target="_blank" rel="noopener">https://www.ej-technologies.com/download/jprofiler/files</a></li>
<li>å®‰è£… JProfiler Idea æ’ä»¶ï¼šåœ¨ <code>Idea</code> æ’ä»¶å¸‚åœºæœç´¢ JProfiler å®‰è£…ï¼Œåœ¨æ’ä»¶è®¾ç½®ä¸­è®¾ç½® JProfiler ç›®å½•ã€‚</li>
<li>ç‚¹å‡» <code>Run</code> æ—è¾¹çš„ JProfiler å›¾æ ‡è¿è¡Œã€‚</li>
</ol>
<hr>
<h2 id="5-Minor-GC-å’Œ-Major-GC-å’Œ-Full-GC"><a href="#5-Minor-GC-å’Œ-Major-GC-å’Œ-Full-GC" class="headerlink" title="5 Minor GC å’Œ Major GC å’Œ Full GC"></a>5 Minor GC å’Œ Major GC å’Œ Full GC</h2><p>JVM åœ¨è¿›è¡Œ GC æ—¶ï¼Œå¹¶éæ¯æ¬¡éƒ½å¯¹ä¸Šé¢ä¸‰ä¸ªå†…å­˜åŒºåŸŸï¼ˆæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ–¹æ³•åŒºï¼‰ä¸€èµ·å›æ”¶çš„ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å›æ”¶çš„éƒ½æ˜¯æŒ‡æ–°ç”Ÿä»£ã€‚</p>
<p>é’ˆå¯¹ HotSpot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC æŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç§ç±»å‹ï¼šä¸€ç§æ˜¯éƒ¨åˆ†æ”¶é›† (Partial GC)ï¼Œä¸€ç§æ˜¯æ•´å †æ”¶é›† (Full GC)</p>
<ul>
<li>éƒ¨åˆ†æ”¶é›†ï¼šä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ª Java å †çš„åƒåœ¾æ”¶é›†ã€‚å…¶ä¸­åˆåˆ†ä¸º:<ul>
<li>â¢ æ–°ç”Ÿä»£æ”¶é›† (Minor GC / Young GC) : åªæ˜¯æ–°ç”Ÿä»£ï¼ˆEdenã€s0ã€s1ï¼‰çš„åƒåœ¾æ”¶é›†</li>
<li>â¢ è€å¹´ä»£æ”¶é›† (Major GC / Old GC) : åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚<ul>
<li>ç›®å‰ï¼Œåªæœ‰ CMS GC ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚<ul>
<li><em>æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™ Major GC ä¼šå’Œ Full GC æ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶</em>ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>â¢ æ··åˆæ”¶é›† (Mixed GC): æ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚<ul>
<li>ç›®å‰ï¼Œåªæœ‰ G1 GC ä¼šæœ‰è¿™ç§è¡Œä¸º</li>
</ul>
</li>
</ul>
</li>
<li>æ•´å †æ”¶é›† (Full GC): æ”¶é›†æ•´ä¸ª java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li>
</ul>
<hr>
<h3 id="æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶"><a href="#æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶" class="headerlink" title="æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶"></a>æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶</h3><ul>
<li><p>â— <strong>å¹´è½»ä»£ GC (Minor GC ) è§¦å‘æœºåˆ¶</strong>:</p>
<ul>
<li>â¢ å½“å¹´è½»ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘ Minor GCï¼Œè¿™é‡Œçš„å¹´è½»ä»£æ»¡æŒ‡çš„æ˜¯ Eden ä»£æ»¡ï¼ŒSurvivor æ»¡ä¸ä¼šå¼•å‘ GCã€‚(æ¯æ¬¡ Minor GC ä¼šæ¸…ç†å¹´è½»ä»£çš„å†…å­˜ã€‚)</li>
<li>â¢ å› ä¸º Java<strong>å¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§</strong>ï¼Œæ‰€ä»¥ MinorGC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚è¿™ä¸€å®šä¹‰æ—¢æ¸…æ™°åˆæ˜“äºç†è§£ã€‚</li>
<li>â¢ Minor GC ä¼šå¼•å‘ STWï¼Œ æš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œã€‚</li>
</ul>
</li>
<li><p>â— <strong>è€å¹´ä»£ GC (Major GC/Full GC) è§¦å‘æœºåˆ¶</strong>:</p>
<ul>
<li>â¢ æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå¯¹è±¡ä»è€å¹´ä»£æ¶ˆå¤±æ—¶ï¼Œæˆ‘ä»¬è¯´ â€œMajor GCâ€ æˆ– â€œFull GCâ€ å‘ç”Ÿäº†ã€‚</li>
<li>â¢ å‡ºç°äº† Major GCï¼Œ ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ Minor GC (ä½†éç»å¯¹çš„ï¼Œåœ¨ Parallel Scavenge æ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡Œ Major GC çš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹)ã€‚<ul>
<li>ä¹Ÿå°±æ˜¯åœ¨è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘ Minor GCã€‚å¦‚æœä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™è§¦å‘ Major GC</li>
</ul>
</li>
<li>â¢ Major GC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” Minor GC æ…¢ 10 å€ä»¥ä¸Šï¼ŒSTW çš„æ—¶é—´æ›´é•¿ã€‚</li>
<li>â¢ å¦‚æœ Major GC åï¼Œå†…å­˜è¿˜ä¸è¶³ï¼Œå°±æŠ¥ <code>OOM</code> äº†ã€‚</li>
</ul>
</li>
<li><p>â— <strong>Full GC è§¦å‘æœºåˆ¶: (åé¢ç»†è®²)</strong><br>è§¦å‘ Full GC æ‰§è¡Œçš„æƒ…å†µæœ‰å¦‚ä¸‹äº”ç§:  </p>
<ul>
<li>(1) è°ƒç”¨ <code>System.gc()</code> æ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡Œ <strong>Full GC</strong>ï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œ</li>
<li>(2) è€å¹´ä»£ç©ºé—´ä¸è¶³</li>
<li>(3) æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li>
<li>(4) é€šè¿‡ Minor GC åè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li>
<li>(5) ç”± Eden åŒºã€survivor space0 (From Space) åŒºå‘ survivor space1 (To Space) åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äº To Space å¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°</li>
</ul>
<p>è¯´æ˜: <strong>Full GC æ˜¯å¼€å‘æˆ–è°ƒä¼˜ä¸­å°½é‡è¦é¿å…çš„ã€‚è¿™æ ·æš‚æ—¶æ—¶é—´ä¼šçŸ­ä¸€äº›</strong>ã€‚</p>
</li>
</ul>
<h3 id="GCä¸¾ä¾‹ä¸æ—¥å¿—åˆ†æ"><a href="#GCä¸¾ä¾‹ä¸æ—¥å¿—åˆ†æ" class="headerlink" title="GCä¸¾ä¾‹ä¸æ—¥å¿—åˆ†æ"></a>GCä¸¾ä¾‹ä¸æ—¥å¿—åˆ†æ</h3><p>æµ‹è¯•ä»£ç ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•MinorGC ã€ MajorGCã€FullGC</span></span><br><span class="line"><span class="comment"> * -Xms9m -Xmx9m -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  14:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GCTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            String a = <span class="string">"atguigu.com"</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                list.add(a);</span><br><span class="line">                a = a + a;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            t.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"éå†æ¬¡æ•°ä¸ºï¼š"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è®¾ç½® VM optionsï¼Œè¿è¡Œï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">2036</span>K-&gt;<span class="number">496</span>K(<span class="number">2560</span>K)] <span class="number">2036</span>K-&gt;<span class="number">871</span>K(<span class="number">9728</span>K), <span class="number">0.0062912</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.01</span>, real=<span class="number">0.00</span> secs]</span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">1964</span>K-&gt;<span class="number">480</span>K(<span class="number">2560</span>K)] <span class="number">2340</span>K-&gt;<span class="number">1682</span>K(<span class="number">9728</span>K), <span class="number">0.0017672</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">1941</span>K-&gt;<span class="number">160</span>K(<span class="number">2560</span>K)] <span class="number">3144</span>K-&gt;<span class="number">2770</span>K(<span class="number">9728</span>K), <span class="number">0.0017537</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 1008K-&gt;0<span class="title">K</span><span class="params">(<span class="number">2560</span>K)</span>] [ParOldGen: 6834K-&gt;4588<span class="title">K</span><span class="params">(<span class="number">7168</span>K)</span>] 7843K-&gt;4588<span class="title">K</span><span class="params">(<span class="number">9728</span>K)</span>, [Metaspace: 3012K-&gt;3012<span class="title">K</span><span class="params">(<span class="number">1056768</span>K)</span>], 0.0051738 secs] [Times: user</span>=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">0</span>K-&gt;<span class="number">0</span>K(<span class="number">2560</span>K)] <span class="number">4588</span>K-&gt;<span class="number">4588</span>K(<span class="number">9728</span>K), <span class="number">0.0009531</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Allocation Failure)</span> [PSYoungGen: 0K-&gt;0<span class="title">K</span><span class="params">(<span class="number">2560</span>K)</span>] [ParOldGen: 4588K-&gt;4570<span class="title">K</span><span class="params">(<span class="number">7168</span>K)</span>] 4588K-&gt;4570<span class="title">K</span><span class="params">(<span class="number">9728</span>K)</span>, [Metaspace: 3012K-&gt;3012<span class="title">K</span><span class="params">(<span class="number">1056768</span>K)</span>], 0.0038536 secs] [Times: user</span>=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br><span class="line">éå†æ¬¡æ•°ä¸ºï¼š<span class="number">16</span></span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">2560</span>K, used <span class="number">136</span>K [<span class="number">0x00000007bfd00000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">2048</span>K, <span class="number">6</span>% used [<span class="number">0x00000007bfd00000</span>,<span class="number">0x00000007bfd22300</span>,<span class="number">0x00000007bff00000</span>)</span><br><span class="line">  from space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff80000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">7168</span>K, used <span class="number">4570</span>K [<span class="number">0x00000007bf600000</span>, <span class="number">0x00000007bfd00000</span>, <span class="number">0x00000007bfd00000</span>)</span><br><span class="line">  object space <span class="number">7168</span>K, <span class="number">63</span>% used [<span class="number">0x00000007bf600000</span>,<span class="number">0x00000007bfa76938</span>,<span class="number">0x00000007bfd00000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3086</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 337<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line"> at java.util.Arrays.copyOf(Arrays.java:<span class="number">3332</span>)</span><br><span class="line"> at java.lang.AbstractStringBuilder.ensureCapacityInternal(AbstractStringBuilder.java:<span class="number">124</span>)</span><br><span class="line"> at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:<span class="number">448</span>)</span><br><span class="line"> at java.lang.StringBuilder.append(StringBuilder.java:<span class="number">136</span>)</span><br><span class="line"> at com.atguigu.java1.GCTest.main(GCTest.java:<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p><em>åˆ†æ</em>ï¼š</p>
<p><code>[GC (Allocation Failure) [PSYoungGen: 2036K-&gt;496K(2560K)] 2036K-&gt;871K(9728K), 0.0062912 secs] [Times: user=0.01 sys=0.01, real=0.00 secs]</code></p>
<p>å¹´è½»ä»£GCï¼šGCå‰å¹´è½»ä»£ 2036Kï¼ŒGCåå¹´è½»ä»£496K (å¹´è½»ä»£æ€»å¤§å°2560K, 2.5M)ï¼›GCå‰å †2036Kï¼ŒGCåå †871Kï¼ˆå †æ€»å¤§å°9728K, 9.5M åŒ…æ‹¬è€å¹´ä»£ï¼‰</p>
<p>GCåå¹´è½»ä»£å¤§å°æ²¡æœ‰å˜æˆ 0Kï¼Œå› ä¸ºæœ‰ä¸€éƒ¨åˆ†å¯¹è±¡ä¿å­˜åœ¨å¹¸å­˜è€…åŒºæ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</p>
<p><code>[Full GC (Ergonomics) [PSYoungGen: 1008K-&gt;0K(2560K)] [ParOldGen: 6834K-&gt;4588K(7168K)] 7843K-&gt;4588K(9728K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0051738 secs] [Times: user=0.02 sys=0.00, real=0.00 secs]</code></p>
<p>Full GCï¼šGCå‰å¹´è½»ä»£1008Kï¼ŒGCåå¹´è½»ä»£0K ï¼ˆå¹´è½»ä»£æ€»å¤§å°2560Kï¼Œ2.5Mï¼‰ï¼›GCå‰è€å¹´ä»£6834Kï¼ŒGCåè€å¹´ä»£4588K ï¼ˆè€å¹´ä»£æ€»å¤§å°7168Kï¼Œ7Mï¼‰ï¼›GCå‰å †7834Kï¼ŒGCåå †4588K ï¼ˆå †æ€»å¤§å° 9728K, 9.5M ï¼‰</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 2560K, used 136K [0x00000007bfd00000, 0x00000007c0000000, 0x00000007c0000000)</span><br><span class="line">  eden space 2048K, 6% used [0x00000007bfd00000,0x00000007bfd22300,0x00000007bff00000)</span><br><span class="line">  from space 512K, 0% used [0x00000007bff80000,0x00000007bff80000,0x00000007c0000000)</span><br><span class="line">  to   space 512K, 0% used [0x00000007bff00000,0x00000007bff00000,0x00000007bff80000)</span><br><span class="line"> ParOldGen       total 7168K, used 4570K [0x00000007bf600000, 0x00000007bfd00000, 0x00000007bfd00000)</span><br><span class="line">  object space 7168K, 63% used [0x00000007bf600000,0x00000007bfa76938,0x00000007bfd00000)</span><br><span class="line"> Metaspace       used 3086K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 337K, capacity 388K, committed 512K, reserved 1048576K</span><br></pre></td></tr></table></figure></div>

<p>å¹´è½»ä»£2560Kï¼Œ2.5M ï¼›ä¼Šç”¸å›­åŒº2Mï¼Œfromã€toå„0.5M<br>è€å¹´ä»£7168Kï¼Œ7 M  </p>
<p>ğŸ¤”ğŸ¤”ä»ä¸Šé¢æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œå †ç©ºé—´å®é™…ä¸Šå¤§äºè®¾ç½®çš„å‚æ•°9Mâ“</p>
<hr>
<iframe width="1015" height="549" src="https://www.youtube.com/embed/vY-gi_7M_Mc?list=PLtGk8Nqe2ZcK0xUtbQjHeX2gqgoOdKJnX" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<hr>
<h2 id="6-å †ç©ºé—´åˆ†ä»£æ€æƒ³"><a href="#6-å †ç©ºé—´åˆ†ä»£æ€æƒ³" class="headerlink" title="6 å †ç©ºé—´åˆ†ä»£æ€æƒ³"></a>6 å †ç©ºé—´åˆ†ä»£æ€æƒ³</h2><p>ä¸ºä»€ä¹ˆéœ€è¦å¯¹ Java å †è¿›è¡Œåˆ†ä»£ï¼Ÿä¸åˆ†ä»£å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†å—ï¼Ÿ</p>
<ul>
<li>ç»ç ”ç©¶ï¼Œä¸åŒå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸åŒã€‚70%-99% çš„å¯¹è±¡æ˜¯ä¸´æ—¶å¯¹è±¡ã€‚<ul>
<li>â¢ æ–°ç”Ÿä»£ï¼šæœ‰ Edenã€ä¸¤å—å¤§å°ç›¸åŒçš„ Survivor (åˆç§°ä¸º from/toï¼Œ s0/s1) æ„æˆï¼Œto æ€»ä¸ºç©ºã€‚</li>
<li>â¢ è€å¹´ä»£ï¼šå­˜æ”¾æ–°ç”Ÿä»£ä¸­ç»å†å¤šæ¬¡ GC ä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</li>
</ul>
</li>
<li>å…¶å®ä¸åˆ†ä»£å®Œå…¨å¯ä»¥ï¼Œåˆ†ä»£çš„å”¯ä¸€ç†ç”±å°±æ˜¯ä¼˜åŒ– Gc æ€§èƒ½ã€‚å¦‚æœæ²¡æœ‰åˆ†ä»£ï¼Œé‚£æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ä¸€å—ï¼Œå°±å¦‚åŒæŠŠä¸€ä¸ªå­¦æ ¡çš„äººéƒ½å…³åœ¨ä¸€ä¸ªæ•™å®¤ã€‚GC çš„æ—¶å€™è¦æ‰¾åˆ°å“ªäº›å¯¹è±¡æ²¡ç”¨ï¼Œè¿™æ ·å°±ä¼šå¯¹å †çš„æ‰€æœ‰åŒºåŸŸè¿›è¡Œæ‰«æã€‚è€Œå¾ˆå¤šå¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œå¦‚æœåˆ†ä»£çš„è¯ï¼ŒæŠŠæ–°åˆ›å»ºçš„å¯¹è±¡æ”¾åˆ°æŸä¸€åœ°æ–¹ï¼Œ å½“ GC çš„æ—¶å€™å…ˆæŠŠè¿™å—å­˜å‚¨ â€œæœç”Ÿå¤•æ­»â€ å¯¹è±¡çš„åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè¿™æ ·å°±ä¼šè…¾å‡ºå¾ˆå¤§çš„ç©ºé—´å‡ºæ¥ã€‚</li>
</ul>
<hr>
<h2 id="7-å†…å­˜åˆ†é…ç­–ç•¥"><a href="#7-å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="7 å†…å­˜åˆ†é…ç­–ç•¥"></a>7 å†…å­˜åˆ†é…ç­–ç•¥</h2><p>å¦‚æœå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ç¬¬æ¬¡ MinorGC åä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢« Survivor å®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ° survivor ç©ºé—´ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º 1ã€‚å¯¹è±¡åœ¨ Survivor åŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ MinorGCï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®š<br>ç¨‹åº¦ (é»˜è®¤ä¸º 15 å²ï¼Œå…¶å®æ¯ä¸ª JVMã€æ¯ä¸ª GC éƒ½æœ‰æ‰€ä¸åŒ) æ—¶ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚</p>
<p>å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹ <code>-XX:MaxTenuringThreshold</code> æ¥è®¾ç½®</p>
<p>é’ˆå¯¹ä¸åŒå¹´é¾„æ®µçš„å¯¹è±¡åˆ†é…åŸåˆ™å¦‚ä¸‹æ‰€ç¤º:</p>
<ul>
<li>â— ä¼˜å…ˆåˆ†é…åˆ° Eden</li>
<li>â— å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£<ul>
<li>å°½é‡é¿å…ç¨‹åºä¸­å‡ºç°è¿‡å¤šçš„å¤§å¯¹è±¡</li>
</ul>
</li>
<li>â— é•¿æœŸå­˜æ´»çš„å¯¹è±¡åˆ†é…åˆ°è€å¹´ä»£</li>
<li>â— åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­<ul>
<li>å¦‚æœ Survivor åŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œ<strong>å¹´é¾„å¤§äºæˆ–ç­‰äº</strong>è¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ° <code>MaxTenuringThreshold</code> ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</li>
</ul>
</li>
<li>â— ç©ºé—´åˆ†é…æ‹…ä¿<ul>
<li><code>-XX:HandlePromotionFailure</code></li>
</ul>
</li>
</ul>
<p>æµ‹è¯•ï¼šå¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æµ‹è¯•ï¼šå¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</span></span><br><span class="line"><span class="comment"> * -Xms60m -Xmx60m -XX:NewRatio=2 -XX:SurvivorRatio=8 -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  21:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YoungOldAreaTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">20</span>];<span class="comment">//20m</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è®¾ç½® VM options ä¸º <code>-Xms60m -Xmx60m -XX:NewRatio=2 -XX:SurvivorRatio=8 -XX:+PrintGCDetails</code> ï¼Œåœ¨ Java 8 ä¸‹è¿è¡Œï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">18432</span>K, used <span class="number">2308</span>K [<span class="number">0x00000007bec00000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">16384</span>K, <span class="number">14</span>% used [<span class="number">0x00000007bec00000</span>,<span class="number">0x00000007bee41048</span>,<span class="number">0x00000007bfc00000</span>)</span><br><span class="line">  from space <span class="number">2048</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bfe00000</span>,<span class="number">0x00000007bfe00000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">2048</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bfc00000</span>,<span class="number">0x00000007bfc00000</span>,<span class="number">0x00000007bfe00000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">40960</span>K, used <span class="number">20480</span>K [<span class="number">0x00000007bc400000</span>, <span class="number">0x00000007bec00000</span>, <span class="number">0x00000007bec00000</span>)</span><br><span class="line">  object space <span class="number">40960</span>K, <span class="number">50</span>% used [<span class="number">0x00000007bc400000</span>,<span class="number">0x00000007bd800010</span>,<span class="number">0x00000007bec00000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3080</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 337<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure></div>

<p>åœ¨ JDK1.7 ä¸‹è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">18432</span>K, used <span class="number">1967</span>K [<span class="number">0x00000007fec00000</span>, <span class="number">0x0000000800000000</span>, <span class="number">0x0000000800000000</span>)</span><br><span class="line">  eden space <span class="number">16384</span>K, <span class="number">12</span>% used [<span class="number">0x00000007fec00000</span>,<span class="number">0x00000007fedebc28</span>,<span class="number">0x00000007ffc00000</span>)</span><br><span class="line">  from space <span class="number">2048</span>K, <span class="number">0</span>% used [<span class="number">0x00000007ffe00000</span>,<span class="number">0x00000007ffe00000</span>,<span class="number">0x0000000800000000</span>)</span><br><span class="line">  to   space <span class="number">2048</span>K, <span class="number">0</span>% used [<span class="number">0x00000007ffc00000</span>,<span class="number">0x00000007ffc00000</span>,<span class="number">0x00000007ffe00000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">40960</span>K, used <span class="number">20480</span>K [<span class="number">0x00000007fc400000</span>, <span class="number">0x00000007fec00000</span>, <span class="number">0x00000007fec00000</span>)</span><br><span class="line">  object space <span class="number">40960</span>K, <span class="number">50</span>% used [<span class="number">0x00000007fc400000</span>,<span class="number">0x00000007fd800010</span>,<span class="number">0x00000007fec00000</span>)</span><br><span class="line"> PSPermGen       total <span class="number">21504</span>K, used <span class="number">2986</span>K [<span class="number">0x00000007f7200000</span>, <span class="number">0x00000007f8700000</span>, <span class="number">0x00000007fc400000</span>)</span><br><span class="line">  object space <span class="number">21504</span>K, <span class="number">13</span>% used [<span class="number">0x00000007f7200000</span>,<span class="number">0x00000007f74eab58</span>,<span class="number">0x00000007f8700000</span>)</span><br></pre></td></tr></table></figure></div>

<p>è®¾ç½®äº†å †ç©ºé—´æœ€å° / å¤§ä¸º 60Mï¼Œæ–°ç”Ÿä»£ä¸è€å¹´ä»£ä¹‹é—´çš„æ¯”ä¾‹ä¸º 2:1ï¼Œä¼Šç”¸å›­åŒºä¸å¹¸å­˜è€…åŒºä¹‹é—´çš„æ¯”ä¾‹ä¸º 8:1:1ï¼Œæ‰“å° GC æ—¥å¿—è¯¦æƒ…ã€‚æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº 16M + ä¸¤ä¸ªå¹¸å­˜è€…åŒº 2M*2ï¼‰20Mï¼Œè€å¹´ä»£ 40Mï¼Œè€å¹´ä»£å·²ç”¨ç©ºé—´ 20Mï¼Œç”±æ­¤å¯è§ï¼Œä¼Šç”¸å›­åŒºå®¹çº³ä¸ä¸‹ 20M çš„æ•°ç»„ï¼Œåˆ†é…çš„ä¸€ä¸ª 20M çš„æ•°ç»„ç›´æ¥è¿›å…¥äº†è€å¹´ä»£ã€‚</p>
<hr>
<h2 id="8-ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB"><a href="#8-ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB" class="headerlink" title="8 ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB"></a>8 ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB</h2><p><strong>ä¸ºä»€ä¹ˆæœ‰ TLAB ( Thread Local Allocation Buffer )</strong> ?</p>
<ul>
<li>â— å †åŒºæ˜¯çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åˆ°å †åŒºä¸­çš„å…±äº«æ•°æ®</li>
<li>â— ç”±äºå¯¹è±¡å®ä¾‹çš„åˆ›å»ºåœ¨ JVM ä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä»å †åŒºä¸­åˆ’åˆ†å†…å­˜ç©ºé—´æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</li>
<li>â— ä¸ºé¿å…å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€åœ°å€ï¼Œéœ€è¦ä½¿ç”¨åŠ é”ç­‰æœºåˆ¶ï¼Œè¿›è€Œå½±å“åˆ†é…é€Ÿåº¦ã€‚</li>
</ul>
<p><strong>ä»€ä¹ˆæ˜¯ TLAB</strong> ?</p>
<ul>
<li>ä»å†…å­˜æ¨¡å‹è€Œä¸æ˜¯åƒåœ¾æ”¶é›†çš„è§’åº¦ï¼Œå¯¹ Eden åŒºåŸŸç»§ç»­è¿›è¡Œåˆ’åˆ†ï¼ŒJVM <strong>ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªç§æœ‰ç¼“å­˜åŒºåŸŸ</strong>ï¼Œå®ƒåŒ…å«åœ¨ Eden ç©ºé—´å†…ã€‚</li>
<li>å¤šçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œä½¿ç”¨ TLAB å¯ä»¥é¿å…ä¸€ç³»åˆ—çš„<del>é</del>çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿæå‡å†…å­˜åˆ†é…çš„ååé‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ç§å†…å­˜åˆ†é…æ–¹å¼ç§°ä¹‹ä¸º<strong>å¿«é€Ÿåˆ†é…</strong>ç­–ç•¥ã€‚</li>
<li>æ®æˆ‘æ‰€çŸ¥æ‰€æœ‰ OpenJDK è¡ç”Ÿå‡ºæ¥çš„ JVM éƒ½æä¾›äº† TLAB çš„è®¾è®¡ã€‚</li>
</ul>
<p><strong>TLAB çš„å†è¯´æ˜</strong>:</p>
<ul>
<li>å°½ç®¡ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½èƒ½å¤Ÿåœ¨ TLAB ä¸­æˆåŠŸåˆ†é…å†…å­˜ (å› ä¸ºç©ºé—´å¾ˆå°)ï¼Œä½† <strong>JVM ç¡®å®æ˜¯å°† TLAB ä½œä¸ºå†…å­˜åˆ†é…çš„é¦–é€‰</strong> ï¼ˆä½¿ç”¨å‘½ä»¤ <code>jinfo -flag UseTLAB pid</code> æŸ¥çœ‹ TLAB æ˜¯å¦å¼€å¯ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰ã€‚</li>
<li>åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹ â€œ<code>-XX:UseTLAB</code>â€œ è®¾ç½®æ˜¯å¦å¼€å¯ TLAB ç©ºé—´ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒTLAB ç©ºé—´çš„å†…å­˜éå¸¸å°ï¼Œ<strong>ä»…å æœ‰æ•´ä¸ª Eden ç©ºé—´çš„ 1%</strong>ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>jinfo -flag TLABWasteTargetPercent pid</code> æŸ¥çœ‹ TLAB å ä¼Šç”¸å›­åŒºçš„ç™¾åˆ†æ¯”ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰é¡¹ <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">â€œ<code>-XX:TLABWasteTargetPercent</code>â€œ</a> è®¾ç½® TLAB ç©ºé—´æ‰€å ç”¨ Eden ç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ã€‚</li>
<li>ä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´åˆ†é…å†…å­˜å¤±è´¥æ—¶ï¼ŒJVM å°±ä¼šå°è¯•ç€ <strong>é€šè¿‡ä½¿ç”¨åŠ é”æœºåˆ¶</strong> ç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§ï¼Œä»è€Œç›´æ¥åœ¨ Eden ç©ºé—´ä¸­åˆ†é…å†…å­˜ã€‚</li>
</ul>
<p><img src="/2020/07/11/JVM-04/TLAB.png" alt="å¯¹è±¡åˆ†é…è¿‡ç¨‹ï¼šTLAB"></p>
<hr>
<h2 id="9-å°ç»“å †ç©ºé—´çš„å‚æ•°è®¾ç½®"><a href="#9-å°ç»“å †ç©ºé—´çš„å‚æ•°è®¾ç½®" class="headerlink" title="9 å°ç»“å †ç©ºé—´çš„å‚æ•°è®¾ç½®"></a>9 å°ç»“å †ç©ºé—´çš„å‚æ•°è®¾ç½®</h2><p>å †ç©ºé—´çš„å‚æ•°è®¾ç½®</p>
<p>å®˜ç½‘è¯´æ˜ï¼š<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></p>
<ul>
<li><code>-XX:+PrintFlagsInitial</code> : æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼</li>
<li><code>-XX:+PrintFlagsFinal</code> : æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„æœ€ç»ˆå€¼ (å¯èƒ½ä¼šå­˜åœ¨ä¿®æ”¹ï¼Œä¸å†æ˜¯åˆå§‹å€¼)</li>
<li><code>-Xms</code> : åˆå§‹å †ç©ºé—´å†…å­˜ ( é»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64)</li>
<li><code>-Xmx</code> : æœ€å¤§å †ç©ºé—´å†…å­˜ ( é»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4)</li>
<li><code>-Xmn</code> : è®¾ç½®æ–°ç”Ÿä»£çš„å¤§å°ã€‚(åˆå§‹å€¼åŠæœ€å¤§å€¼)</li>
<li><code>-XX:NewRatio</code> : é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”</li>
<li><code>-XX:SurvivorRatio</code> : è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ S0/S1 ç©ºé—´çš„æ¯”ä¾‹</li>
<li><code>-XX:MaxTenuringThreshold</code> : è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„</li>
<li><code>-XX:+PrintGCDetails</code> : è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿—<ul>
<li>â¢ æ‰“å° GC ç®€è¦ä¿¡æ¯: â‘  <code>-XX:+PrintGC</code> â‘¡ <code>-verbose:gc</code></li>
</ul>
</li>
<li><code>-XX:HandlePromotionFailure</code> : æ˜¯å¦è®¾ç½®ç©ºé—´åˆ†é…æ‹…ä¿</li>
</ul>
<p><strong>å…³äºå‚æ•°</strong> <code>-XX:SurvivorRatio</code></p>
<p>å¹´è½»ä»£ä¸­ï¼Œè‹¥ä¼Šç”¸å›­åŒºè®¾ç½®è¿‡å¤§ï¼Œå¹¸å­˜è€…åŒºè¾ƒå°ï¼Œåˆ™å®¹æ˜“å¯¼è‡´åœ¨ YGC / Minor GC æ—¶ï¼Œä¼Šç”¸å›­åŒºä¸­å‰©ä½™çš„å¯¹è±¡ç›´æ¥æ™‹å‡è€å¹´ä»£ï¼Œåˆ™åˆ†ä»£çš„æ„ä¹‰å°±ä¸å¤§äº†ã€‚</p>
<p>è‹¥ä¼Šç”¸å›­åŒºè®¾ç½®è¿‡å°ï¼Œå¹¸å­˜è€…åŒºè¿‡å¤§ï¼Œåˆ™å®¹æ˜“å¯¼è‡´ YGC / Minor GC çš„é¢‘ç‡å¢åŠ ï¼Œæ›´åŠ é¢‘ç¹çš„åƒåœ¾å›æ”¶ä¼šå¢åŠ  STW çš„æ€»ä½“æ—¶é—´ï¼Œå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<p>ä»æ€§èƒ½è°ƒä¼˜çš„è§’åº¦ï¼Œéƒ½åº”è¯¥é™ä½ GC çš„é¢‘ç‡ã€‚</p>
<p><strong>å…³äºå‚æ•°</strong> <code>-XX:HandlePromotionFailure</code></p>
<p>åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼š<strong>æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´</strong>ã€‚</p>
<ul>
<li>å¦‚æœå¤§äºï¼Œåˆ™æ­¤æ¬¡ Minor GC æ˜¯å®‰å…¨çš„</li>
<li>å¦‚æœå°äºï¼Œåˆ™è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ <code>-XX:HandlePromotionFailure</code> è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ã€‚<ul>
<li>å¦‚æœ <code>HandlePromotionFailure</code>=trueï¼Œ é‚£ä¹ˆä¼šç»§ç»­<strong>æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°</strong>ã€‚<ul>
<li>å¦‚æœå¤§äºï¼Œåˆ™å°è¯•è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œä½†è¿™æ¬¡ Minor GC ä¾ç„¶æ˜¯æœ‰é£é™©çš„ï¼›</li>
<li>å¦‚æœå°äºï¼Œåˆ™æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡ Full GCã€‚</li>
</ul>
</li>
<li>å¦‚æœ <code>HandlePromotionFailure</code>=falseï¼Œ åˆ™æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡ Full GCã€‚</li>
</ul>
</li>
</ul>
<p>åœ¨ JDK6 Update24 ä¹‹åï¼ŒHandlePromotionFailure å‚æ•°ä¸ä¼šå†å½±å“åˆ°è™›æ‹Ÿæœºçš„ç©ºé—´åˆ†é…æ‹…ä¿ç­–ç•¥ï¼Œè§‚å¯Ÿ OpenJDK ä¸­çš„æºç å˜åŒ–ï¼Œè™½ç„¶æºç ä¸­è¿˜å®šä¹‰äº† HandlePromotionFailure å‚æ•°ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­å·²ç»ä¸ä¼šå†ä½¿ç”¨å®ƒã€‚JDK6 Update24 ä¹‹åçš„è§„åˆ™å˜ä¸º<strong>åªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°æˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°å°±ä¼šè¿›è¡Œ Minor GCï¼Œ å¦åˆ™å°†è¿›è¡Œ Full GC</strong>ã€‚</p>
<hr>
<h2 id="X-å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å—"><a href="#X-å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å—" class="headerlink" title="X å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å—"></a>X å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å—</h2><p><strong>å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å—</strong> ï¼Ÿ</p>
<p>åœ¨ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ä¸­å…³äº Java å †å†…å­˜æœ‰è¿™æ ·ä¸€æ®µæè¿°:</p>
<p>éšç€ JIT ç¼–è¯‘æœŸçš„å‘å±•ä¸<strong>é€ƒé€¸åˆ†ææŠ€æœ¯</strong>é€æ¸æˆç†Ÿï¼Œ<strong>æ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯</strong>å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆ â€œç»å¯¹â€ äº†ã€‚</p>
<p>åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡æ˜¯åœ¨ Java å †ä¸­åˆ†é…å†…å­˜çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®éçš„å¸¸è¯†ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œé‚£å°±æ˜¯å¦‚æœç»è¿‡<strong>é€ƒé€¸åˆ†æ (Escape Analysis) åå‘ç°ï¼Œä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…</strong>ã€‚è¿™æ ·å°±æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œä¹Ÿæ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„å †å¤–å­˜å‚¨æŠ€æœ¯ã€‚</p>
<p>æ­¤å¤–ï¼Œå‰é¢æåˆ°çš„åŸºäº OpenJDK æ·±åº¦å®šåˆ¶çš„ TaoBaoVM, å…¶ä¸­åˆ›æ–°çš„ GCIH (GC invisible heap) æŠ€æœ¯å®ç° off-heap, å°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„ Java å¯¹è±¡ä» heap ä¸­ç§»è‡³ heap å¤–ï¼Œå¹¶ä¸” GC ä¸èƒ½ç®¡ç† GCIH å†…éƒ¨çš„ Java å¯¹è±¡ï¼Œä»¥æ­¤è¾¾åˆ°é™ä½ GC çš„å›æ”¶é¢‘ç‡å’Œæå‡ GC çš„å›æ”¶æ•ˆç‡çš„ç›®çš„ã€‚</p>
<h3 id="é€ƒé€¸åˆ†ææ¦‚è¿°"><a href="#é€ƒé€¸åˆ†ææ¦‚è¿°" class="headerlink" title="é€ƒé€¸åˆ†ææ¦‚è¿°"></a>é€ƒé€¸åˆ†ææ¦‚è¿°</h3><ul>
<li>å¦‚ä½•å°†å †ä¸Šçš„å¯¹è±¡åˆ†é…åˆ°æ ˆï¼Œéœ€è¦ä½¿ç”¨é€ƒé€¸åˆ†ææ‰‹æ®µã€‚</li>
<li>è¿™æ˜¯ä¸€ç§å¯ä»¥æœ‰æ•ˆå‡å°‘Javaç¨‹åºä¸­åŒæ­¥è´Ÿè½½å’Œå†…å­˜å †åˆ†é…å‹åŠ›çš„è·¨å‡½æ•°å…¨å±€æ•°æ®æµåˆ†æç®—æ³•ã€‚</li>
<li>é€šè¿‡é€ƒé€¸åˆ†æï¼ŒJava Hotspotç¼–è¯‘å™¨èƒ½å¤Ÿåˆ†æå‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡çš„å¼•ç”¨çš„ä½¿ç”¨èŒƒå›´ä»è€Œå†³å®šæ˜¯å¦è¦å°†è¿™ä¸ªå¯¹è±¡åˆ†é…åˆ°å †ä¸Šã€‚</li>
<li>é€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸ:;<ul>
<li>â¢ å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå¯¹è±¡åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å‘ç”Ÿé€ƒé€¸ã€‚</li>
<li>â¢ å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå®ƒè¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œåˆ™è®¤ä¸ºå‘ç”Ÿé€ƒé€¸ã€‚ä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ä¸­ã€‚</li>
</ul>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">my_method</span><span class="params">()</span></span>&#123;</span><br><span class="line">    V v = <span class="keyword">new</span> V();</span><br><span class="line">    <span class="comment">// use v</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    v = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„ç°è±¡ï¼Œåˆ™å¯ä»¥åˆ†é…åˆ°æ ˆä¸Šï¼Œéšç€æ–¹æ³•æ‰§è¡Œçš„ç»“æŸï¼Œæ ˆç©ºé—´å°±è¢«ç§»é™¤ã€‚</p>
<p>ç”±ä¾‹å¦‚ï¼Œ</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StringBuffer <span class="title">createStringBuffer</span><span class="params">(String s2, String s2)</span></span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœæƒ³è¦ StringBuffer sb ä¸é€ƒå‡ºæ–¹æ³•ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createStringBuffer</span><span class="params">(String s2, String s2)</span></span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>é€ƒé€¸åˆ†æçš„å„ç§æƒ…å†µï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€ƒé€¸åˆ†æ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  å¦‚ä½•å¿«é€Ÿçš„åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†é€ƒé€¸åˆ†æï¼Œå¤§å®¶å°±çœ‹newçš„å¯¹è±¡å®ä½“æ˜¯å¦æœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020 ä¸‹åˆ 4:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EscapeAnalysis</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> EscapeAnalysis obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ–¹æ³•è¿”å›EscapeAnalysiså¯¹è±¡ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EscapeAnalysis <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj == <span class="keyword">null</span>? <span class="keyword">new</span> EscapeAnalysis() : obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ä¸ºæˆå‘˜å±æ€§èµ‹å€¼ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObj</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj = <span class="keyword">new</span> EscapeAnalysis();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ€è€ƒï¼šå¦‚æœå½“å‰çš„objå¼•ç”¨å£°æ˜ä¸ºstaticçš„ï¼Ÿä»ç„¶ä¼šå‘ç”Ÿé€ƒé€¸ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹è±¡çš„ä½œç”¨åŸŸä»…åœ¨å½“å‰æ–¹æ³•ä¸­æœ‰æ•ˆï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">useEscapeAnalysis</span><span class="params">()</span></span>&#123;</span><br><span class="line">        EscapeAnalysis e = <span class="keyword">new</span> EscapeAnalysis();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¼•ç”¨æˆå‘˜å˜é‡çš„å€¼ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">useEscapeAnalysis1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        EscapeAnalysis e = getInstance();</span><br><span class="line">        <span class="comment">//getInstance().xxx()åŒæ ·ä¼šå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å‚æ•°è®¾ç½®:</p>
<ul>
<li>â— åœ¨ JDK 6u23 ç‰ˆæœ¬ä¹‹åï¼ŒHotSpot ä¸­é»˜è®¤å°±å·²ç»å¼€å¯äº†é€ƒé€¸åˆ†æã€‚</li>
<li>â— å¦‚æœä½¿ç”¨çš„æ˜¯è¾ƒæ—©çš„ç‰ˆæœ¬ï¼Œå¼€å‘äººå‘˜åˆ™å¯ä»¥é€šè¿‡:<ul>
<li>â¢ é€‰é¡¹ â€œ<code>-XX:+DoEscapeAnalysis</code>â€œ æ˜¾å¼å¼€å¯é€ƒé€¸åˆ†æ</li>
<li>â¢ é€šè¿‡é€‰é¡¹ â€œ<code>-XX:+PrintEscapeAnalysis</code>â€œ æŸ¥çœ‹é€ƒé€¸åˆ†æçš„ç­›é€‰ç»“æœã€‚<ul>
<li>ï¼ˆå®æµ‹è¿™ä¸ªå‚æ•°ä¸è¢«è¯†åˆ«ï¼ŒæŠ¥é”™ <code>Unrecognized VM option &#39;PrintEscapeAnalysis&#39;</code> åˆ›å»º JVM å¤±è´¥ï¼Œéœ€è¦ä½¿ç”¨å¸¦ debug çš„ JDKï¼Œä¾‹å¦‚ç¬¬ä¸‰æ–¹ç¼–è¯‘çš„ <code>java-1.8.0-openjdk-fastdebug-1.8.0.111-1.b15.ojdkbuild.windows.x86_64.zip</code> ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ç»“è®ºï¼š<strong>å¼€å‘ä¸­èƒ½ä½¿ç”¨å±€éƒ¨å˜é‡çš„ï¼Œå°±ä¸è¦ä½¿ç”¨åœ¨æ–¹æ³•å¤–å®šä¹‰ã€‚</strong></p>
<h3 id="é€ƒé€¸åˆ†æä¹‹ä»£ç ä¼˜åŒ–"><a href="#é€ƒé€¸åˆ†æä¹‹ä»£ç ä¼˜åŒ–" class="headerlink" title="é€ƒé€¸åˆ†æä¹‹ä»£ç ä¼˜åŒ–"></a>é€ƒé€¸åˆ†æä¹‹ä»£ç ä¼˜åŒ–</h3><p>ä½¿ç”¨é€ƒé€¸åˆ†æï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç åšå¦‚ä¸‹ä¼˜åŒ–:</p>
<ul>
<li>ä¸€ã€<strong>æ ˆä¸Šåˆ†é…</strong>ã€‚å°†å †åˆ†é…è½¬åŒ–ä¸ºæ ˆåˆ†é…ã€‚å¦‚æœ-ä¸€ä¸ªå¯¹è±¡åœ¨å­ç¨‹åºä¸­è¢«åˆ†é…, è¦ä½¿æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆæ°¸è¿œä¸ä¼šé€ƒé€¸ï¼Œå¯¹è±¡å¯èƒ½æ˜¯æ ˆåˆ†é…çš„å€™é€‰ï¼Œè€Œä¸æ˜¯å †åˆ†é…ã€‚</li>
<li>äºŒã€<strong>åŒæ­¥çœç•¥</strong>ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å‘ç°åªèƒ½ä»ä¸€ä¸ªçº¿ç¨‹è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå¯¹è±¡çš„æ“ä½œå¯ä»¥ä¸è€ƒè™‘åŒæ­¥ã€‚</li>
<li>ä¸‰ã€<strong>åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢</strong>ã€‚æœ‰çš„å¯¹è±¡å¯èƒ½ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªè¿ç»­çš„å†…å­˜ç»“æ„å­˜åœ¨ä¹Ÿå¯ä»¥è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹è±¡çš„éƒ¨åˆ†(æˆ–å…¨éƒ¨)å¯ä»¥ä¸å­˜å‚¨åœ¨å†…å­˜ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ CPU å¯„å­˜å™¨ä¸­ã€‚</li>
</ul>
<h4 id="ä»£ç ä¼˜åŒ–ä¹‹æ ˆä¸Šåˆ†é…"><a href="#ä»£ç ä¼˜åŒ–ä¹‹æ ˆä¸Šåˆ†é…" class="headerlink" title="ä»£ç ä¼˜åŒ–ä¹‹æ ˆä¸Šåˆ†é…"></a>ä»£ç ä¼˜åŒ–ä¹‹æ ˆä¸Šåˆ†é…</h4><ul>
<li>JIT ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´æ ¹æ®é€ƒé€¸åˆ†æçš„ç»“æœï¼Œå‘ç°å¦‚æœä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…ã€‚åˆ†é…å®Œæˆåï¼Œç»§ç»­åœ¨è°ƒç”¨æ ˆå†…æ‰§è¡Œï¼Œæœ€åçº¿ç¨‹ç»“æŸï¼Œæ ˆç©ºé—´è¢«å›æ”¶ï¼Œå±€éƒ¨å˜é‡å¯¹è±¡ä¹Ÿè¢«å›æ”¶ã€‚è¿™æ ·å°±æ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚</li>
<li>å¸¸è§çš„æ ˆä¸Šåˆ†é…çš„åœºæ™¯<ul>
<li>â¢ åœ¨é€ƒé€¸åˆ†æä¸­ï¼Œå·²ç»è¯´æ˜äº†ã€‚é€ƒé€¸å‡ºæ–¹æ³•ï¼šåˆ†åˆ«æ˜¯ç»™æˆå‘˜å˜é‡èµ‹å€¼ã€æ–¹æ³•è¿”å›å€¼ã€å®ä¾‹å¼•ç”¨ä¼ é€’ã€‚</li>
</ul>
</li>
</ul>
<p>ä»£ç æ¼”ç¤ºï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ˆä¸Šåˆ†é…æµ‹è¯•</span></span><br><span class="line"><span class="comment"> * -Xmx1G -Xms1G -XX:-DoEscapeAnalysis -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  10:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StackAllocation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            alloc();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š "</span> + (end - start) + <span class="string">" ms"</span>);</span><br><span class="line">        <span class="comment">// ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹å †å†…å­˜ä¸­å¯¹è±¡ä¸ªæ•°ï¼Œçº¿ç¨‹sleep</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e1) &#123;</span><br><span class="line">            e1.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">alloc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();<span class="comment">//æœªå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¸¤ç§æƒ…å†µä¸‹è¿è¡Œï¼Œä½¿ç”¨ VisualVM Sampler æŸ¥çœ‹ Memory æƒ…å†µã€‚</p>
<p>è®¾ç½® VM options ä¸º <code>-Xmx1G -Xms1G -XX:-DoEscapeAnalysis -XX:+PrintGCDetails</code>, è¿è¡Œ;</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">97</span> ms</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">305664</span>K, used <span class="number">188744</span>K [<span class="number">0x00000007aab00000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">262144</span>K, <span class="number">72</span>% used [<span class="number">0x00000007aab00000</span>,<span class="number">0x00000007b63521c8</span>,<span class="number">0x00000007bab00000</span>)</span><br><span class="line">  from space <span class="number">43520</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bd580000</span>,<span class="number">0x00000007bd580000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">43520</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bab00000</span>,<span class="number">0x00000007bab00000</span>,<span class="number">0x00000007bd580000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">699392</span>K, used <span class="number">0</span>K [<span class="number">0x0000000780000000</span>, <span class="number">0x00000007aab00000</span>, <span class="number">0x00000007aab00000</span>)</span><br><span class="line">  object space <span class="number">699392</span>K, <span class="number">0</span>% used [<span class="number">0x0000000780000000</span>,<span class="number">0x0000000780000000</span>,<span class="number">0x00000007aab00000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3608</span>K, capacity <span class="number">4540</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 399<span class="title">K</span>, <span class="title">capacity</span> 428<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2020/07/11/JVM-04/StackAllocation1.png" alt="å…³é—­é€ƒé€¸åˆ†æ"></p>
<p>å¯¹æ¯” VM options ä¸º <code>-Xmx1G -Xms1G -XX:+DoEscapeAnalysis -XX:+PrintGCDetails</code>, è¿è¡Œã€‚</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">4</span> ms</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">305664</span>K, used <span class="number">78643</span>K [<span class="number">0x00000007aab00000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">262144</span>K, <span class="number">30</span>% used [<span class="number">0x00000007aab00000</span>,<span class="number">0x00000007af7ccfd8</span>,<span class="number">0x00000007bab00000</span>)</span><br><span class="line">  from space <span class="number">43520</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bd580000</span>,<span class="number">0x00000007bd580000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">43520</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bab00000</span>,<span class="number">0x00000007bab00000</span>,<span class="number">0x00000007bd580000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">699392</span>K, used <span class="number">0</span>K [<span class="number">0x0000000780000000</span>, <span class="number">0x00000007aab00000</span>, <span class="number">0x00000007aab00000</span>)</span><br><span class="line">  object space <span class="number">699392</span>K, <span class="number">0</span>% used [<span class="number">0x0000000780000000</span>,<span class="number">0x0000000780000000</span>,<span class="number">0x00000007aab00000</span>)</span><br><span class="line"> Metaspace       used <span class="number">8857</span>K, capacity <span class="number">9194</span>K, committed <span class="number">9344</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 1037<span class="title">K</span>, <span class="title">capacity</span> 1132<span class="title">K</span>, <span class="title">committed</span> 1152<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2020/07/11/JVM-04/StackAllocation2.png" alt="å¼€å¯é€ƒé€¸åˆ†æ"></p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºæ˜¯å¦å¼€å¯é€ƒé€¸åˆ†ææ—¶çš„å†…å­˜å ç”¨æƒ…å†µï¼Œå¼€å¯äº†é€ƒé€¸åˆ†æå†…å­˜å ç”¨æ˜æ˜¾é™ä½ï¼Œç”±äºä½¿ç”¨äº†æ ˆä¸Šåˆ†é…ï¼Œä¸ç”¨ç»´æŠ¤ 1000 ä¸‡ä¸ª User å¯¹è±¡äº†ï¼Œè€Œä¸”åˆ›å»º 1000 ä¸‡ä¸ª User å¯¹è±¡æ‰€ç”¨æ—¶é—´ä¹Ÿæ˜æ˜¾é™ä½ã€‚</p>
<p>åœ¨ Windows (ä½¿ç”¨çš„æ˜¯ä¸Šé¢æåˆ°çš„ fastdebug JDKï¼Œå¦åˆ™ <code>+PrintEscapeAnalysis</code> ä¸å¯ç”¨) ä¸­è¿è¡Œä¸Šè¿°ç¨‹åºï¼Œæ‰“å°é€ƒé€¸åˆ†ææ—¥å¿—ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\yan\java&gt; java <span class="literal">-Xmx1G</span> <span class="literal">-Xms1G</span> <span class="literal">-XX</span>:+DoEscapeAnalysis <span class="literal">-XX</span>:+PrintGCDetails <span class="literal">-XX</span>:+PrintEscapeAnalysis <span class="string">'StackAllocation'</span></span><br><span class="line"></span><br><span class="line">======== Connection graph <span class="keyword">for</span>  StackAllocation::alloc</span><br><span class="line">JavaObject NoEscape(NoEscape) [ [ <span class="number">36</span> ]]   <span class="number">24</span>    Allocate        ===  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">1</span> ( <span class="number">22</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">1</span>  <span class="number">1</span> ) [[ <span class="number">25</span>  <span class="number">26</span>  <span class="number">27</span>  <span class="number">34</span>  <span class="number">35</span>  <span class="number">36</span> ]]  rawptr:NotNull ( int:&gt;=<span class="number">0</span>, java/lang/Object:NotNull *, bool, top ) StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> !jvms: StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span></span><br><span class="line">LocalVar [ <span class="number">24</span><span class="type">P</span> [ ]]   <span class="number">36</span>        Proj    ===  <span class="number">24</span>  [[ <span class="number">37</span> ]] <span class="comment">#5 !jvms: StackAllocation::alloc @ bci:0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======== Connection graph <span class="keyword">for</span>  StackAllocation::main</span><br><span class="line">JavaObject NoEscape(NoEscape) [ [ <span class="number">119</span> ]]   <span class="number">107</span>  Allocate        ===  <span class="number">86</span>  <span class="number">76</span>  <span class="number">103</span>  <span class="number">8</span>  <span class="number">1</span> ( <span class="number">32</span>  <span class="number">105</span>  <span class="number">20</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">29</span>  <span class="number">1</span>  <span class="number">79</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> ) [[ <span class="number">108</span>  <span class="number">109</span>  <span class="number">110</span>  <span class="number">117</span>  <span class="number">118</span>  <span class="number">119</span> ]]  rawptr:NotNull ( int:&gt;=<span class="number">0</span>, java/lang/Object:NotNull *, bool, top ) StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span> !jvms: StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span></span><br><span class="line">LocalVar [ <span class="number">107</span><span class="type">P</span> [ ]]   <span class="number">119</span>      Proj    ===  <span class="number">107</span>  [[ <span class="number">120</span> ]] <span class="comment">#5 !jvms: StackAllocation::alloc @ bci:0 StackAllocation::main @ bci:12</span></span><br><span class="line"></span><br><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">15</span> ms</span><br><span class="line"></span><br><span class="line">======== Connection graph <span class="keyword">for</span>  StackAllocation::main</span><br><span class="line">JavaObject NoEscape(NoEscape) [ [ <span class="number">98</span> ]]   <span class="number">86</span>    Allocate        ===  <span class="number">366</span>  <span class="number">68</span>  <span class="number">358</span>  <span class="number">8</span>  <span class="number">1</span> ( <span class="number">84</span>  <span class="number">83</span>  <span class="number">26</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">24</span>  <span class="number">1</span>  <span class="number">70</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> ) [[ <span class="number">87</span>  <span class="number">88</span>  <span class="number">89</span>  <span class="number">96</span>  <span class="number">97</span>  <span class="number">98</span> ]]  rawptr:NotNull ( int:&gt;=<span class="number">0</span>, java/lang/Object:NotNull *, bool, top ) StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span> !jvms: StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span></span><br><span class="line">LocalVar [ <span class="number">86</span><span class="type">P</span> [ ]]   <span class="number">98</span>        Proj    ===  <span class="number">86</span>  [[ <span class="number">99</span> ]] <span class="comment">#5 !jvms: StackAllocation::alloc @ bci:0 StackAllocation::main @ bci:12</span></span><br><span class="line"></span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">305664</span>K, used <span class="number">36700</span>K [<span class="number">0</span><span class="type">x00000000eab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">262144</span><span class="type">K</span>, <span class="number">14</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000eab00000</span>,<span class="number">0</span><span class="type">x00000000eced7188</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">43520</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fd580000</span>,<span class="number">0</span><span class="type">x00000000fd580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">43520</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000fd580000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">699392</span><span class="type">K</span>, <span class="type">used</span> <span class="number">0</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000c0000000</span>, <span class="number">0</span><span class="type">x00000000eab00000</span>, <span class="number">0</span><span class="type">x00000000eab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">699392</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000c0000000</span>,<span class="number">0</span><span class="type">x00000000c0000000</span>,<span class="number">0</span><span class="type">x00000000eab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">2885</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4486</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">273</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">386</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br><span class="line"></span><br><span class="line"><span class="type">PS</span> <span class="type">C</span>:\<span class="type">Users</span>\<span class="type">yan</span>\<span class="type">java</span>&gt; <span class="type">java</span> -<span class="type">Xmx1G</span> -<span class="type">Xms1G</span> -<span class="type">XX</span>:-<span class="type">DoEscapeAnalysis</span> -<span class="type">XX</span>:+<span class="type">PrintGCDetails</span> -<span class="type">XX</span>:+<span class="type">PrintEscapeAnalysis</span> <span class="string">'StackAllocation'</span></span><br><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">47</span> <span class="type">ms</span></span><br><span class="line"><span class="type">Heap</span></span><br><span class="line"> <span class="type">PSYoungGen</span>      <span class="type">total</span> <span class="number">305664</span><span class="type">K</span>, <span class="type">used</span> <span class="number">167772</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000eab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">262144</span><span class="type">K</span>, <span class="number">64</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000eab00000</span>,<span class="number">0</span><span class="type">x00000000f4ed72c8</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">43520</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fd580000</span>,<span class="number">0</span><span class="type">x00000000fd580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">43520</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000fd580000</span>)</span><br><span class="line"> <span class="type">ParOld</span></span><br></pre></td></tr></table></figure></div>

<p>å¦‚æœå°† heap çš„å¤§å°è®¾ç½®ä¸º 256M , å¹¶ä¸”ä¸ä½¿ç”¨é€ƒé€¸åˆ†æï¼Œå¯ä»¥çœ‹åˆ°å‘ç”Ÿäº† GCï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\yan\java&gt; java <span class="literal">-Xmx256M</span> <span class="literal">-Xms256M</span> <span class="literal">-XX</span>:<span class="literal">-DoEscapeAnalysis</span> <span class="literal">-XX</span>:+PrintGCDetails <span class="literal">-XX</span>:+PrintEscapeAnalysis <span class="string">'StackAllocation'</span></span><br><span class="line">[<span class="type">GC</span> (<span class="type">Allocation</span> <span class="type">Failure</span>) [<span class="type">PSYoungGen</span>: <span class="number">65536</span><span class="type">K</span>-&gt;<span class="number">760</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">65536</span><span class="type">K</span>-&gt;<span class="number">768</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0093114</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>]</span><br><span class="line">[<span class="type">GC</span> (<span class="type">Allocation</span> <span class="type">Failure</span>) [<span class="type">PSYoungGen</span>: <span class="number">66296</span><span class="type">K</span>-&gt;<span class="number">688</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">66304</span><span class="type">K</span>-&gt;<span class="number">696</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0071857</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.02</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.02</span> <span class="type">secs</span>]</span><br><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">63</span> ms</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">76288</span>K, used <span class="number">29524</span>K [<span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">65536</span><span class="type">K</span>, <span class="number">44</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000fc729048</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">6</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x00000000ff62c040</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">175104</span><span class="type">K</span>, <span class="type">used</span> <span class="number">8</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">175104</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000f0002000</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">2885</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4486</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">273</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">386</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br></pre></td></tr></table></figure></div>

<p>å¦‚æœå°† heap çš„å¤§å°è®¾ç½®ä¸º 256M , å¼€å¯ä½¿ç”¨é€ƒé€¸åˆ†æï¼Œå¯ä»¥çœ‹åˆ°æ²¡æœ‰å‘ç”Ÿ GC ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\yan\java&gt; java <span class="literal">-Xmx256M</span> <span class="literal">-Xms256M</span> <span class="literal">-XX</span>:+DoEscapeAnalysis <span class="literal">-XX</span>:+PrintGCDetails <span class="literal">-XX</span>:+PrintEscapeAnalysis <span class="string">'StackAllocation'</span></span><br><span class="line"></span><br><span class="line">======== Connection graph <span class="keyword">for</span>  StackAllocation::alloc</span><br><span class="line">JavaObject NoEscape(NoEscape) [ [ <span class="number">36</span> ]]   <span class="number">24</span>    Allocate        ===  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">1</span> ( <span class="number">22</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">1</span>  <span class="number">1</span> ) [[ <span class="number">25</span>  <span class="number">26</span>  <span class="number">27</span>  <span class="number">34</span>  <span class="number">35</span>  <span class="number">36</span> ]]  rawptr:NotNull ( int:&gt;=<span class="number">0</span>, java/lang/Object:NotNull *, bool, top ) StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> !jvms: StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span></span><br><span class="line">LocalVar [ <span class="number">24</span><span class="type">P</span> [ ]]   <span class="number">36</span>        Proj    ===  <span class="number">24</span>  [[ <span class="number">37</span> ]] <span class="comment">#5 !jvms: StackAllocation::alloc @ bci:0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======== Connection graph <span class="keyword">for</span>  StackAllocation::main</span><br><span class="line">JavaObject NoEscape(NoEscape) [ [ <span class="number">119</span> ]]   <span class="number">107</span>  Allocate        ===  <span class="number">86</span>  <span class="number">76</span>  <span class="number">103</span>  <span class="number">8</span>  <span class="number">1</span> ( <span class="number">32</span>  <span class="number">105</span>  <span class="number">20</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">29</span>  <span class="number">1</span>  <span class="number">79</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> ) [[ <span class="number">108</span>  <span class="number">109</span>  <span class="number">110</span>  <span class="number">117</span>  <span class="number">118</span>  <span class="number">119</span> ]]  rawptr:NotNull ( int:&gt;=<span class="number">0</span>, java/lang/Object:NotNull *, bool, top ) StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span> !jvms: StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span></span><br><span class="line">LocalVar [ <span class="number">107</span><span class="type">P</span> [ ]]   <span class="number">119</span>      Proj    ===  <span class="number">107</span>  [[ <span class="number">120</span> ]] <span class="comment">#5 !jvms: StackAllocation::alloc @ bci:0 StackAllocation::main @ bci:12</span></span><br><span class="line"></span><br><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">31</span> ms</span><br><span class="line">======== Connection graph <span class="keyword">for</span></span><br><span class="line"> StackAllocation::main</span><br><span class="line">JavaObject NoEscape(NoEscape) [ [ <span class="number">98</span> ]]   <span class="number">86</span>    Allocate        ===  <span class="number">366</span>  <span class="number">68</span>  <span class="number">358</span>  <span class="number">8</span>  <span class="number">1</span> ( <span class="number">84</span>  <span class="number">83</span>  <span class="number">26</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">24</span>  <span class="number">1</span>  <span class="number">70</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> ) [[ <span class="number">87</span>  <span class="number">88</span>  <span class="number">89</span>  <span class="number">96</span>  <span class="number">97</span>  <span class="number">98</span> ]]  rawptr:NotNull ( int:&gt;=<span class="number">0</span>, java/lang/Object:NotNull *, bool, top ) StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span> !jvms: StackAllocation::alloc <span class="selector-tag">@</span> bci:<span class="number">0</span> StackAllocation::main <span class="selector-tag">@</span> bci:<span class="number">12</span></span><br><span class="line">LocalVar [ <span class="number">86</span><span class="type">P</span> [ ]]   <span class="number">98</span>        Proj    ===  <span class="number">86</span>  [[ <span class="number">99</span> ]] <span class="comment">#5 !jvms: StackAllocation::alloc @ bci:0 StackAllocation::main @ bci:12</span></span><br><span class="line"></span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">76288</span>K, used <span class="number">26214</span>K [<span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">65536</span><span class="type">K</span>, <span class="number">40</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000fc499a88</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">175104</span><span class="type">K</span>, <span class="type">used</span> <span class="number">0</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">175104</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">2885</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4486</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">273</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">386</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br><span class="line"><span class="type">PS</span> <span class="type">C</span>:\<span class="type">Users</span>\<span class="type">yan</span>\<span class="type">java</span>&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="ä»£ç ä¼˜åŒ–ä¹‹åŒæ­¥çœç•¥ï¼ˆæ¶ˆé™¤ï¼‰"><a href="#ä»£ç ä¼˜åŒ–ä¹‹åŒæ­¥çœç•¥ï¼ˆæ¶ˆé™¤ï¼‰" class="headerlink" title="ä»£ç ä¼˜åŒ–ä¹‹åŒæ­¥çœç•¥ï¼ˆæ¶ˆé™¤ï¼‰"></a>ä»£ç ä¼˜åŒ–ä¹‹åŒæ­¥çœç•¥ï¼ˆæ¶ˆé™¤ï¼‰</h4><ul>
<li>çº¿ç¨‹åŒæ­¥çš„ä»£ä»·æ˜¯ç›¸å½“é«˜çš„ï¼ŒåŒæ­¥çš„åæœæ˜¯é™ä½å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚</li>
<li>åœ¨åŠ¨æ€ç¼–è¯‘åŒæ­¥å—çš„æ—¶å€™ï¼ŒJIT ç¼–è¯‘å™¨å¯ä»¥å€ŸåŠ©é€ƒé€¸åˆ†ææ¥<strong>åˆ¤æ–­åŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å¦åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®è€Œæ²¡æœ‰è¢«å‘å¸ƒåˆ°å…¶ä»–çº¿ç¨‹</strong>ã€‚å¦‚æœï¼ˆæ˜¯ä¸Šè¿°æƒ…å†µã€ï¼‰æ²¡æœ‰ï¼ˆè¢«å‘å¸ƒåˆ°å…¶ä»–çº¿ç¨‹ï¼‰ï¼Œé‚£ä¹ˆ JIT ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªåŒæ­¥å—çš„æ—¶å€™å°±ä¼šå–æ¶ˆå¯¹è¿™éƒ¨åˆ†ä»£ç çš„åŒæ­¥ã€‚è¿™æ ·å°±èƒ½å¤§å¤§æé«˜å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚è¿™ä¸ªå–æ¶ˆåŒæ­¥çš„è¿‡ç¨‹å°±å«åŒæ­¥çœç•¥ï¼Œä¹Ÿå«<strong>é”æ¶ˆé™¤</strong>ã€‚</li>
</ul>
<p>å¦‚ä»¥ä¸‹ä»£ç :</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Object hollis = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">synchronized</span>(hollis)&#123;</span><br><span class="line">        System.out.println(hollis);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä»£ç ä¸­å¯¹ hollis è¿™ä¸ªå¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯ hollis å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåªåœ¨ f() æ–¹æ³•ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€è®¿é—®åˆ°ï¼Œæ‰€ä»¥åœ¨ JIT ç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«ä¼˜åŒ–æ‰ã€‚ä¼˜åŒ–æˆ:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Object hollis = <span class="keyword">new</span> Object();</span><br><span class="line">    System.out.println(hollis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å®é™…ä¸Šï¼Œä¸Šé¢è¿™ä¹ˆå†™ä¹Ÿèµ·ä¸åˆ°åŒæ­¥ä½œç”¨ï¼Œå› ä¸ºä½¿ç”¨æœ¬åœ°å±€éƒ¨å˜é‡å½“ä½œé”å¯¹è±¡ï¼Œæ¯ä¸ªè¿›ç¨‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•éƒ½ä¼š new ä¸€ä¸ªæ–°çš„é”å¯¹è±¡ï¼Œä»è€Œæ¯ä¸ªçº¿ç¨‹æ‰€ä½¿ç”¨çš„å¯¹è±¡ç›‘è§†å™¨éƒ½æ˜¯ä¸åŒçš„ï¼Œèµ·ä¸åˆ°åŒæ­¥çš„ä½œç”¨ã€‚<br>è€Œä¸”ï¼Œä¸Šé¢é‚£ç§å†™æ³• javac ç¼–è¯‘é˜¶æ®µç”Ÿæˆçš„å­—èŠ‚ç ä¸­è¿˜æ˜¯ä¼šæœ‰åŒæ­¥çš„å­—èŠ‚ç æŒ‡ä»¤ç”Ÿæˆ ï¼ˆ <code>monitorenter</code> å’Œ <code>monitorexit</code> ï¼‰ã€‚f() å¯¹åº”å­—èŠ‚ç æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> 0 new #2 &lt;java/lang/Object&gt;</span><br><span class="line"> <span class="number">3</span> dup</span><br><span class="line"> 4 invokespecial #1 &lt;java/lang/Object.&lt;init&gt;&gt;</span><br><span class="line"> <span class="number">7</span> astore_1</span><br><span class="line"> <span class="number">8</span> aload_1</span><br><span class="line"> <span class="number">9</span> dup</span><br><span class="line"><span class="number">10</span> astore_2</span><br><span class="line"><span class="number">11</span> monitorenter</span><br><span class="line">12 getstatic #3 &lt;java/lang/System.out&gt;</span><br><span class="line"><span class="number">15</span> aload_1</span><br><span class="line">16 invokevirtual #4 &lt;java/io/PrintStream.println&gt;</span><br><span class="line"><span class="number">19</span> aload_2</span><br><span class="line"><span class="number">20</span> monitorexit</span><br><span class="line"><span class="number">21</span> goto <span class="number">29</span> (+<span class="number">8</span>)</span><br><span class="line"><span class="number">24</span> astore_3</span><br><span class="line"><span class="number">25</span> aload_2</span><br><span class="line"><span class="number">26</span> monitorexit</span><br><span class="line"><span class="number">27</span> aload_3</span><br><span class="line"><span class="number">28</span> athrow</span><br><span class="line"><span class="number">29</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure></div>

<h4 id="ğŸŒ¿-ä»£ç ä¼˜åŒ–ä¹‹æ ‡é‡æ›¿æ¢"><a href="#ğŸŒ¿-ä»£ç ä¼˜åŒ–ä¹‹æ ‡é‡æ›¿æ¢" class="headerlink" title="ğŸŒ¿ ä»£ç ä¼˜åŒ–ä¹‹æ ‡é‡æ›¿æ¢"></a>ğŸŒ¿ ä»£ç ä¼˜åŒ–ä¹‹æ ‡é‡æ›¿æ¢</h4><p><strong>æ ‡é‡ (Scalar)</strong> æ˜¯æŒ‡ä¸€ä¸ªæ— æ³•å†åˆ†è§£æˆæ›´å°çš„æ•°æ®çš„æ•°æ®ã€‚Java ä¸­çš„åŸå§‹æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ã€‚</p>
<p>ç›¸å¯¹çš„ï¼Œé‚£äº›è¿˜å¯ä»¥åˆ†è§£çš„æ•°æ®å«åš<strong>èšåˆé‡ (Aggregate)</strong> ï¼ŒJava ä¸­çš„å¯¹è±¡å°±æ˜¯èšåˆé‡ï¼Œå› ä¸ºä»–å¯ä»¥åˆ†è§£æˆå…¶ä»–èšåˆé‡å’Œæ ‡é‡ã€‚</p>
<p>åœ¨ JIT é˜¶æ®µï¼Œå¦‚æœç»è¿‡é€ƒé€¸åˆ†æï¼Œå‘ç°ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å¤–ç•Œè®¿é—®çš„è¯ï¼Œé‚£ä¹ˆç»è¿‡ JIT ä¼˜åŒ–ï¼Œå°±ä¼šæŠŠè¿™ä¸ªå¯¹è±¡æ‹†è§£æˆè‹¥åƒä¸ªå…¶ä¸­åŒ…å«çš„è‹¥å¹²ä¸ªæˆå‘˜å˜é‡æ¥ä»£æ›¿ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯<strong>æ ‡é‡æ›¿æ¢</strong>ã€‚</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    alloc();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">alloc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Point point = <span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    System.out.println(<span class="string">"point.x="</span> + point.x + <span class="string">"; point.y="</span> + point.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä»¥ä¸Šä»£ç ï¼Œç»è¿‡æ ‡é‡æ›¿æ¢åï¼Œå°±ä¼šå˜æˆ:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">alloc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> y = <span class="number">2</span>;</span><br><span class="line">    System.out.println(<span class="string">"point.x="</span> + x + <span class="string">"; point.y="</span> + y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒPoint è¿™ä¸ªèšåˆé‡ç»è¿‡é€ƒé€¸åˆ†æåï¼Œå‘ç°ä»–å¹¶æ²¡æœ‰é€ƒé€¸ï¼Œå°±è¢«æ›¿æ¢æˆä¸¤ä¸ªèšåˆé‡äº†ã€‚é‚£ä¹ˆæ ‡é‡æ›¿æ¢æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå°±æ˜¯å¯ä»¥å¤§å¤§å‡å°‘å †å†…å­˜çš„å ç”¨ã€‚å› ä¸ºä¸€æ—¦ä¸éœ€è¦åˆ›å»ºå¯¹è±¡äº†ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦åˆ†é…å †å†…å­˜äº†ã€‚</p>
<p>æ ‡é‡æ›¿æ¢ä¸ºæ ˆä¸Šåˆ†é…æä¾›äº†å¾ˆå¥½çš„åŸºç¡€ã€‚</p>
<p><strong>æ ‡é‡æ›¿æ¢å‚æ•°è®¾ç½®</strong>:</p>
<p>å‚æ•° <code>-XX:+EliminateAllocations</code> : å¼€å¯äº†æ ‡é‡æ›¿æ¢(é»˜è®¤æ‰“å¼€)ï¼Œå…è®¸å°†å¯¹è±¡æ‰“æ•£åˆ†é…åœ¨æ ˆä¸Šã€‚</p>
<p>æµ‹è¯•ï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ‡é‡æ›¿æ¢æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *  -Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:-EliminateAllocations</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  12:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScalarReplace</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">alloc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User();<span class="comment">//æœªå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line">        u.id = <span class="number">5</span>;</span><br><span class="line">        u.name = <span class="string">"www.atguigu.com"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            alloc();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š "</span> + (end - start) + <span class="string">" ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">class Customer&#123;</span></span><br><span class="line"><span class="comment">    String name;</span></span><br><span class="line"><span class="comment">    int id;</span></span><br><span class="line"><span class="comment">    Account acct;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">class Account&#123;</span></span><br><span class="line"><span class="comment">    double balance;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></div>

<p>ä¸Šè¿°ä»£ç åœ¨ä¸»å‡½æ•°ä¸­è¿›è¡Œäº† 10000000 æ¬¡ alloc() ã€‚ è°ƒç”¨è¿›è¡Œå¯¹è±¡åˆ›å»ºï¼Œç”±äº User å¯¹è±¡å®ä¾‹éœ€è¦å æ®çº¦ 16 å­—èŠ‚çš„ç©ºé—´ï¼Œå› æ­¤ç´¯è®¡åˆ†é…ç©ºé—´è¾¾åˆ°å°†è¿‘ 152 MBã€‚å¦‚æœå †ç©ºé—´å°äºè¿™ä¸ªå€¼ï¼Œå°±å¿…ç„¶ä¼šå‘ç”Ÿ GCã€‚ ä½¿ç”¨å¦‚ä¸‹å‚æ•°è¿è¡Œä¸Šè¿°ä»£ç :  </p>
<p><code>-server -Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:+EliminateAllocations +PrintEliminateAllocations</code>  </p>
<p>è¿™é‡Œä½¿ç”¨å‚æ•°å¦‚ä¸‹:  </p>
<ul>
<li>â— å‚æ•° <code>-server</code>: å¯åŠ¨ server æ¨¡å¼ï¼Œ å› ä¸ºåœ¨ Server æ¨¡å¼ä¸‹ï¼Œæ‰å¯ä»¥å¯ç”¨é€ƒé€¸åˆ†æ (ä¸ç”¨æ‰‹åŠ¨å†™è¿™ä¸ªå‚æ•°æ˜¯å› ä¸ºä½¿ç”¨ <code>java -version</code> å¯ä»¥æŸ¥çœ‹åˆ° JDK ç‰ˆæœ¬é»˜è®¤å°±æ˜¯ Server VM)ã€‚  </li>
<li>â— å‚æ•° <code>-XX:+DoEscapeAnalysis</code> : å¯ç”¨é€ƒé€¸åˆ†æ  </li>
<li>â— å‚æ•° <code>-Xmx10m</code> : æŒ‡å®šäº†å †ç©ºé—´æœ€å¤§ä¸º 10MB  </li>
<li>â— å‚æ•° <code>-XX:+PrintGC</code> : å°†æ‰“å° GC æ—¥å¿—ã€‚  </li>
<li>â— å‚æ•° <code>-XX:+EliminateAllocations</code> : å¼€å¯äº†æ ‡é‡æ›¿æ¢ (é»˜è®¤æ‰“å¼€)ï¼Œå…è®¸å°†å¯¹è±¡æ‰“æ•£åˆ†é…åœ¨æ ˆä¸Šï¼Œæ¯”å¦‚å¯¹ è±¡æ‹¥æœ‰ id å’Œnameä¸¤ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—æ®µå°†ä¼šè¢«è§†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å±€éƒ¨å˜é‡è¿›è¡Œåˆ†é…ã€‚  </li>
<li><code>+PrintEliminateAllocations</code> : æ‰“å°æ ‡é‡æ›¿æ¢ä¿¡æ¯ï¼ŒNon-product builds: Print out when allocations are eliminatedï¼Œéäº§å“ç‰ˆæœ¬ï¼Œéœ€è¦ä½¿ç”¨ debug JDK è¿è¡Œã€‚</li>
</ul>
<p>è®¾ç½® VM options ä¸º <code>-Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:-EliminateAllocations</code>ï¼Œå…ˆä¸ä½¿ç”¨æ ‡é‡æ›¿æ¢ <code>-XX:-EliminateAllocations</code>ï¼Œè¿è¡Œä¸Šè¿°ç¨‹åºï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure)  <span class="number">25600</span>K-&gt;<span class="number">584</span>K(<span class="number">98304</span>K), <span class="number">0.0015866</span> secs]</span><br><span class="line">[GC (Allocation Failure)  <span class="number">26184</span>K-&gt;<span class="number">616</span>K(<span class="number">98304</span>K), <span class="number">0.0014574</span> secs]</span><br><span class="line">[GC (Allocation Failure)  <span class="number">26216</span>K-&gt;<span class="number">520</span>K(<span class="number">98304</span>K), <span class="number">0.0013473</span> secs]</span><br><span class="line">[GC (Allocation Failure)  <span class="number">26120</span>K-&gt;<span class="number">536</span>K(<span class="number">98304</span>K), <span class="number">0.0012746</span> secs]</span><br><span class="line">[GC (Allocation Failure)  <span class="number">26136</span>K-&gt;<span class="number">456</span>K(<span class="number">98304</span>K), <span class="number">0.0013713</span> secs]</span><br><span class="line">[GC (Allocation Failure)  <span class="number">26056</span>K-&gt;<span class="number">480</span>K(<span class="number">101376</span>K), <span class="number">0.0016144</span> secs]</span><br><span class="line">[GC (Allocation Failure)  <span class="number">32224</span>K-&gt;<span class="number">440</span>K(<span class="number">101376</span>K), <span class="number">0.0015301</span> secs]</span><br><span class="line">[GC (Allocation Failure)  <span class="number">32184</span>K-&gt;<span class="number">440</span>K(<span class="number">101376</span>K), <span class="number">0.0011484</span> secs]</span><br><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">82</span> ms</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p>è®¾ç½® VM options ä¸º <code>-Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:+EliminateAllocations</code>ï¼Œä½¿ç”¨æ ‡é‡æ›¿æ¢ <code>-XX:+EliminateAllocations</code>ï¼Œå†æ¬¡è¿è¡Œä¸Šè¿°ç¨‹åºï¼š</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">4</span> ms</span><br><span class="line"></span><br><span class="line">Process finished with exit code</span><br></pre></td></tr></table></figure></div>

<p>ä»ç¨‹åºçš„è¿è¡Œç»“æœå¯¹æ¯”æ¥çœ‹ï¼Œå¼€å¯æ ‡é‡æ›¿æ¢æ—¶ï¼Œæ²¡æœ‰å‘ç”Ÿåƒåœ¾å›æ”¶ï¼Œè€Œä¸”æ‰§è¡Œ <code>alloc()</code> æ–¹æ³•åˆ›å»ºå¯¹è±¡ 1000 ä¸‡æ¬¡çš„æ—¶é—´å¾ˆæ˜æ˜¾é™ä½äº†ã€‚</p>
<h4 id="é€ƒé€¸åˆ†æå°ç»“"><a href="#é€ƒé€¸åˆ†æå°ç»“" class="headerlink" title="é€ƒé€¸åˆ†æå°ç»“"></a>é€ƒé€¸åˆ†æå°ç»“</h4><p>é€ƒé€¸åˆ†æå°ç»“:é€ƒé€¸åˆ†æå¹¶ä¸æˆç†Ÿ</p>
<ul>
<li>å…³äºé€ƒé€¸åˆ†æçš„è®ºæ–‡åœ¨ 1999 å¹´å°±å·²ç»å‘è¡¨äº†ï¼Œä½†ç›´åˆ° JDK 1.6 æ‰æœ‰å®ç°ï¼Œè€Œä¸”è¿™é¡¹æŠ€æœ¯åˆ°å¦‚ä»Šä¹Ÿå¹¶ä¸æ˜¯ååˆ†æˆç†Ÿçš„ã€‚</li>
<li>å…¶æ ¹æœ¬åŸå› å°±æ˜¯ <strong>æ— æ³•ä¿è¯é€ƒé€¸åˆ†æçš„æ€§èƒ½æ¶ˆè€—ä¸€å®šèƒ½é«˜äºä»–çš„æ¶ˆè€—ã€‚è™½ç„¶ç»è¿‡é€ƒé€¸åˆ†æå¯ä»¥åšæ ‡é‡æ›¿æ¢ã€æ ˆä¸Šåˆ†é…ã€å’Œé”æ¶ˆé™¤ã€‚ä½†æ˜¯é€ƒé€¸åˆ†æè‡ªèº«ä¹Ÿæ˜¯éœ€è¦è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„åˆ†æçš„ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„è¿‡ç¨‹</strong>ã€‚</li>
<li>ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œå°±æ˜¯ç»è¿‡é€ƒé€¸åˆ†æä¹‹åï¼Œå‘ç°æ²¡æœ‰ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸é€ƒé€¸çš„ã€‚é‚£è¿™ä¸ªé€ƒé€¸åˆ†æçš„è¿‡ç¨‹å°±ç™½ç™½æµªè´¹æ‰äº†ã€‚</li>
<li>è™½ç„¶è¿™é¡¹æŠ€æœ¯å¹¶ä¸ååˆ†æˆç†Ÿï¼Œä½†æ˜¯å®ƒä¹Ÿ<strong>æ˜¯å³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ä¸­ä¸€ä¸ªååˆ†é‡è¦çš„æ‰‹æ®µ</strong>ã€‚</li>
<li>æ³¨æ„åˆ°æœ‰ä¸€äº›è§‚ç‚¹ï¼Œè®¤ä¸ºé€šè¿‡é€ƒé€¸åˆ†æï¼ŒJVM ä¼šåœ¨æ ˆä¸Šåˆ†é…é‚£äº›ä¸ä¼šé€ƒé€¸çš„å¯¹è±¡ï¼Œè¿™åœ¨ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å–å†³äº JVM è®¾è®¡è€…çš„é€‰æ‹©ã€‚æ®æˆ‘æ‰€çŸ¥ï¼ŒOracle Hotspot JVM ä¸­å¹¶æœªè¿™ä¹ˆåšï¼Œè¿™ä¸€ç‚¹åœ¨é€ƒé€¸åˆ†æç›¸å…³çš„æ–‡æ¡£é‡Œå·²ç»è¯´æ˜ï¼Œæ‰€ä»¥å¯ä»¥æ˜ç¡®æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ›å»ºåœ¨å †ä¸Šã€‚<ul>
<li>å‰é¢æ¼”ç¤ºçš„ç¨‹åºä¹‹æ‰€ä»¥ä¼šæœ‰æ ˆä¸Šåˆ†é…çš„é‚£ç§æ•ˆæœï¼Œå¯ä»¥ç†è§£ä¸ºï¼šé€ƒé€¸åˆ†æ + æ ‡é‡æ›¿æ¢ =&gt; æ ˆä¸Šåˆ†é…ï¼›åŸºäºé€ƒé€¸åˆ†æå’Œæ ‡é‡æ›¿æ¢ï¼ŒæŸç§ç¨‹åº¦ä¸Šå¯ä»¥è¯´æ˜¯è¾¾åˆ°äº†æ ˆä¸Šåˆ†é…çš„æ•ˆæœã€‚</li>
</ul>
</li>
<li>ç›®å‰å¾ˆå¤šä¹¦ç±è¿˜æ˜¯åŸºäº JDK 7 ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒJDK å·²ç»å‘ç”Ÿäº†å¾ˆå¤§å˜åŒ–ï¼Œintern å­—ç¬¦ä¸²çš„ç¼“å­˜å’Œé™æ€å˜é‡æ›¾ç»éƒ½è¢«åˆ†é…åœ¨æ°¸ä¹…ä»£ä¸Šï¼Œè€Œæ°¸ä¹…ä»£å·²ç»è¢«å…ƒæ•°æ®åŒºå–ä»£ã€‚ä½†æ˜¯ï¼Œintern å­—ç¬¦ä¸²ç¼“å­˜å’Œé™æ€å˜é‡å¹¶ä¸æ˜¯è¢«è½¬ç§»åˆ°å…ƒæ•°æ®åŒºï¼Œè€Œæ˜¯ç›´æ¥åœ¨å †ä¸Šåˆ†é…ï¼Œæ‰€ä»¥è¿™ä¸€ç‚¹åŒæ ·ç¬¦åˆå‰é¢ä¸€ç‚¹çš„ç»“è®ºï¼šå¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ†é…åœ¨å †ä¸Šã€‚</li>
</ul>
<h2 id="æœ¬ç« å°ç»“"><a href="#æœ¬ç« å°ç»“" class="headerlink" title="æœ¬ç« å°ç»“"></a>æœ¬ç« å°ç»“</h2><ul>
<li>å¹´è½»ä»£æ˜¯å¯¹è±¡çš„è¯ç”Ÿã€æˆé•¿ã€æ¶ˆäº¡çš„åŒºåŸŸï¼Œä¸€ä¸ªå¯¹è±¡åœ¨è¿™é‡Œäº§ç”Ÿã€åº”ç”¨ï¼Œæœ€åè¢«åƒåœ¾å›æ”¶å™¨æ”¶é›†ã€ç»“æŸç”Ÿå‘½ã€‚</li>
<li>è€å¹´ä»£æ”¾ç½®é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œé€šå¸¸éƒ½æ˜¯ä» Survivor åŒºåŸŸç­›é€‰æ‹·è´è¿‡æ¥çš„ Java å¯¹è±¡ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬çŸ¥é“æ™®é€šçš„å¯¹è±¡ä¼šè¢«åˆ†é…åœ¨ TLAB ä¸Šï¼›å¦‚æœå¯¹è±¡è¾ƒå¤§ï¼ŒJVM ä¼šè¯•å›¾ç›´æ¥åˆ†é…åœ¨ Eden å…¶ä»–ä½ç½®ä¸Šï¼›å¦‚æœå¯¹è±¡å¤ªå¤§ï¼Œå®Œå…¨æ— æ³•åœ¨æ–°ç”Ÿä»£æ‰¾åˆ°è¶³å¤Ÿé•¿çš„è¿ç»­ç©ºé—²ç©ºé—´ï¼ŒJVM å°±ä¼šç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚</li>
<li>å½“ GC åªå‘ç”Ÿåœ¨å¹´è½»ä»£ä¸­ï¼Œå›æ”¶å¹´è½»ä»£å¯¹è±¡çš„è¡Œä¸ºè¢«ç§°ä¸º Minor GCã€‚å½“ GC å‘ç”Ÿåœ¨è€å¹´ä»£æ—¶åˆ™è¢«ç§°ä¸º Major GC æˆ–è€… Full GCã€‚ä¸€èˆ¬çš„ï¼ŒMinor GC çš„å‘ç”Ÿé¢‘ç‡è¦æ¯” MajorGC é«˜å¾ˆå¤šï¼Œå³è€å¹´ä»£ä¸­åƒåœ¾å›æ”¶å‘ç”Ÿçš„é¢‘ç‡å°†å¤§å¤§ä½äºå¹´è½»ä»£ã€‚</li>
</ul>

          
      
    </div>
    
    
      <footer class="article-footer">
        å®Œ
      </footer>
    
  </div>
  
    
<nav id="article-nav">
  <div class="article-nav-block">
    
      <a href="../../17/JVM-05/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption"></strong>
        <div class="article-nav-title">
          
            JVM 05 è¿è¡Œæ—¶æ•°æ®åŒºä¹‹æ–¹æ³•åŒº (MethodArea)
          
        </div>
      </a>
    
  </div>
  <div class="article-nav-block">
    
      <a href="../../05/JVM-03/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">JVM 03 è¿è¡Œæ—¶æ•°æ®åŒºä¹‹è™šæ‹Ÿæœºæ ˆ (Stack)</div>
        <strong class="article-nav-caption"></strong>
      </a>
    
  </div>
</nav>

    <!-- <link rel="stylesheet" href="/css/gitment.css">  -->
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<div id="vcommentsContainer"></div>
<!--å¼•ç”¨è¯„è®ºæ¡†è¾“å…¥ç‰¹æ•ˆjsæ–‡ä»¶-->

<script src="../../../../js/shuru.js"></script>

<script>
  POWERMODE.colorful = true; // make power mode colorful
  POWERMODE.shake = true; // turn off shake
  document.body.addEventListener('input', POWERMODE);
</script>
<!-- valineè¯„è®ºç³»ç»Ÿ -->
<script>
  new Valine({
      el: '#vcommentsContainer',
      appId: 'AttjBiS7UwxkxjV1CSrNywoi-gzGzoHsz',
      appKey: 'F50aWycFFmAPLC8CfSW7rXdP',
      avatar: 'monsterid',
      enableQQ: true,
      placeholder: 'æ˜µç§°å¤„å¡«QQå·è‡ªåŠ¨æŠ“å–ç½‘åå’Œé‚®ç®±å“Ÿ~'
  })
</script>


    <!-- <link rel="stylesheet" href="/css/gitment.css"> 
<script src="/js/gitment.js"></script>

<div id="gitmentContainer"></div>

<script>
var gitment = new Gitment({
  owner: '',
  repo: '',
  oauth: {
    client_id: '',
    client_secret: '',
  },
})
gitment.render('gitmentContainer')
</script>

 -->

  
  
</article>
</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="https://q1.qlogo.cn/g?b=qq&amp;nk=979727728&amp;s=640" title="å›¾ç‰‡æ¥è‡ªQQ"></img>
    <h3 class="avatar-name">
      
        è®¸åµ©è€å…¬
      
    </h3>
    <p class="avatar-slogan">
      æ·±å¸ä¸€å£æ¢¦ï¼Œå¹ä¸ªæ°”çƒå­˜èµ·æ¥ã€‚
    </p>
  </div>
</div>


  
    

  
    
  <div class="widget-box">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/NET/" rel="tag">.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Git-Bash/" rel="tag">Git Bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Github/" rel="tag">Github</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Github-Actions/" rel="tag">Github Actions</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/HDFS/" rel="tag">HDFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Hadoop/" rel="tag">Hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Idea/" rel="tag">Idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/MapReduce/" rel="tag">MapReduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Markdown/" rel="tag">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Maven/" rel="tag">Maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Node/" rel="tag">Node</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Node-js/" rel="tag">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Serial-Port/" rel="tag">Serial Port</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/VSCode/" rel="tag">VSCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/YARN/" rel="tag">YARN</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/macOS/" rel="tag">macOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/" rel="tag">ä¸­æ–‡ä¹±ç </a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">å¤§æ•°æ®</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" rel="tag">å®‰è£…æ•™ç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E5%AF%86%E9%92%A5/" rel="tag">å¯†é’¥</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/" rel="tag">å¹¶è¡Œç¼–ç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">æ•°æ®åº“</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E7%94%B5%E8%84%91/" rel="tag">ç”µè„‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E7%AB%B9%E4%BA%91/" rel="tag">ç«¹äº‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E7%BB%88%E7%AB%AF/" rel="tag">ç»ˆç«¯</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E8%84%9A%E6%9C%AC/" rel="tag">è„šæœ¬</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E8%BD%AC%E8%BD%BD/" rel="tag">è½¬è½½</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/%E8%BD%AF%E4%BB%B6/" rel="tag">è½¯ä»¶</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-box">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../../../../tags/NET/" style="font-size: 10px;">.NET</a> <a href="../../../../tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="../../../../tags/Git-Bash/" style="font-size: 11.67px;">Git Bash</a> <a href="../../../../tags/Github/" style="font-size: 13.33px;">Github</a> <a href="../../../../tags/Github-Actions/" style="font-size: 10px;">Github Actions</a> <a href="../../../../tags/HDFS/" style="font-size: 10px;">HDFS</a> <a href="../../../../tags/Hadoop/" style="font-size: 18.33px;">Hadoop</a> <a href="../../../../tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="../../../../tags/Idea/" style="font-size: 10px;">Idea</a> <a href="../../../../tags/JVM/" style="font-size: 18.33px;">JVM</a> <a href="../../../../tags/Java/" style="font-size: 20px;">Java</a> <a href="../../../../tags/JavaScript/" style="font-size: 16.67px;">JavaScript</a> <a href="../../../../tags/Linux/" style="font-size: 15px;">Linux</a> <a href="../../../../tags/MapReduce/" style="font-size: 11.67px;">MapReduce</a> <a href="../../../../tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="../../../../tags/Maven/" style="font-size: 13.33px;">Maven</a> <a href="../../../../tags/Node/" style="font-size: 10px;">Node</a> <a href="../../../../tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="../../../../tags/SQL/" style="font-size: 13.33px;">SQL</a> <a href="../../../../tags/Serial-Port/" style="font-size: 10px;">Serial Port</a> <a href="../../../../tags/Shell/" style="font-size: 11.67px;">Shell</a> <a href="../../../../tags/SpringBoot/" style="font-size: 10px;">SpringBoot</a> <a href="../../../../tags/VSCode/" style="font-size: 10px;">VSCode</a> <a href="../../../../tags/Vue/" style="font-size: 10px;">Vue</a> <a href="../../../../tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="../../../../tags/YARN/" style="font-size: 10px;">YARN</a> <a href="../../../../tags/hexo/" style="font-size: 11.67px;">hexo</a> <a href="../../../../tags/macOS/" style="font-size: 11.67px;">macOS</a> <a href="../../../../tags/ssh/" style="font-size: 11.67px;">ssh</a> <a href="../../../../tags/%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/" style="font-size: 10px;">ä¸­æ–‡ä¹±ç </a> <a href="../../../../tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 10px;">å¤§æ•°æ®</a> <a href="../../../../tags/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" style="font-size: 10px;">å®‰è£…æ•™ç¨‹</a> <a href="../../../../tags/%E5%AF%86%E9%92%A5/" style="font-size: 10px;">å¯†é’¥</a> <a href="../../../../tags/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">å¹¶è¡Œç¼–ç¨‹</a> <a href="../../../../tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">æ•°æ®åº“</a> <a href="../../../../tags/%E7%94%B5%E8%84%91/" style="font-size: 11.67px;">ç”µè„‘</a> <a href="../../../../tags/%E7%AB%B9%E4%BA%91/" style="font-size: 11.67px;">ç«¹äº‘</a> <a href="../../../../tags/%E7%BB%88%E7%AB%AF/" style="font-size: 13.33px;">ç»ˆç«¯</a> <a href="../../../../tags/%E8%84%9A%E6%9C%AC/" style="font-size: 10px;">è„šæœ¬</a> <a href="../../../../tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 10px;">è½¬è½½</a> <a href="../../../../tags/%E8%BD%AF%E4%BB%B6/" style="font-size: 10px;">è½¯ä»¶</a>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/02/">äºŒæœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/01/">ä¸€æœˆ 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/12/">åäºŒæœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/11/">åä¸€æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/09/">ä¹æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/08/">å…«æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/08/">å…«æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/07/">ä¸ƒæœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2020/06/">å…­æœˆ 2020</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../../../../2023/02/13/%E4%BD%BF%E7%94%A8Node-js%E5%90%8E%E5%8F%B0%E8%AF%BB%E5%8F%96%E4%B8%B2%E5%8F%A3%E6%95%B0%E6%8D%AE%E5%B9%B6%E9%80%9A%E8%BF%87WebSocket%E5%AE%9E%E6%97%B6%E6%98%BE%E7%A4%BA%E5%9C%A8%E7%BD%91%E9%A1%B5%E4%B8%8A/">ä½¿ç”¨Node.jsåå°è¯»å–ä¸²å£æ•°æ®å¹¶é€šè¿‡WebSocketå®æ—¶æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š</a>
          </li>
        
          <li>
            <a href="../../../../2023/02/09/SpringBoot%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/">SpringBooté¡¹ç›®ç›¸å…³çŸ¥è¯†ç‚¹</a>
          </li>
        
          <li>
            <a href="../../../../2023/02/09/%E4%BD%9C%E4%B8%BA%E7%94%A8%E6%88%B7%EF%BC%8C%E4%BF%AE%E6%94%B9Cookie%E6%9C%89%E6%95%88%E6%9C%9F%EF%BC%8C%E5%BB%B6%E9%95%BFCookie%E6%9C%9F%E9%99%90/">ä½œä¸ºç”¨æˆ·ï¼Œä¿®æ”¹Cookieæœ‰æ•ˆæœŸï¼Œå»¶é•¿CookieæœŸé™</a>
          </li>
        
          <li>
            <a href="../../../../2023/02/08/%E7%BB%88%E7%AB%AF%E5%91%BD%E4%BB%A4%E4%BB%A3%E7%90%86/">ç»ˆç«¯å‘½ä»¤ç½‘ç»œè®¾ç½®</a>
          </li>
        
          <li>
            <a href="../../../../2023/01/18/Windows%E7%B3%BB%E7%BB%9FC%E7%9B%98%E6%B8%85%E7%90%86%E5%B7%A5%E5%85%B7FreeMove%E5%8F%8A%E6%96%87%E4%BB%B6%E5%8D%A0%E7%94%A8%E8%BF%9B%E7%A8%8B%E6%9F%A5%E7%9C%8B%E8%BD%AF%E4%BB%B6LockHunter%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8/">Windowsç³»ç»ŸCç›˜æ¸…ç†å·¥å…·FreeMoveåŠæ–‡ä»¶å ç”¨è¿›ç¨‹æŸ¥çœ‹è½¯ä»¶LockHunteré…åˆä½¿ç”¨</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">å‹é“¾</h3>
    <div class="widget">
      
        <!-- <a style="display: block;" href="../../../../https:/xiaoyan94.github.io/" title target='_blank' -->
        <a style="display: block;" href="https://xiaoyan94.github.io/" title target='_blank'
        >Github Pages</a>
      
        <!-- <a style="display: block;" href="../../../../https:/xy94.gitee.io/" title target='_blank' -->
        <a style="display: block;" href="https://xy94.gitee.io/" title target='_blank'
        >Gitee Pages</a>
      
    </div>
  </div>

  
 
  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width center">
    &copy; 2023 è®¸åµ©è€å…¬ &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;ä¸»é¢˜ <a href="https://github.com/yiluyanxia/hexo-theme-antiquity" target="_blank" rel="noopener">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">ä¸è’œå­å‘Šä¹‹   é˜ä¸‹æ˜¯ç¬¬<span id="busuanzi_value_site_pv"></span>ä¸ªè®¿å®¢</span>
    
  </div>
  
  <!--å¼•å…¥æ–‡å­—ç‚¹å‡»ç‰¹æ•ˆ-->
  <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
  
<script src="../../../../js/dianji.js"></script>

</footer>

<!--æ·»åŠ å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
<style>
/* å°çŒ«ç½®é¡¶ */
/* è‡ªå®šä¹‰å›åˆ°é¡¶éƒ¨æ ·å¼ */
.cd-top {
  position: fixed;
  right: 25px;
  top: -900px;
  z-index: 99;
  width: 70px;
  height: 900px;
  /* background: url(https://cdn.jsdelivr.net/gh/moezx/cdn@3.1.9/img/Sakura/images/scroll.png) no-repeat center; */
  background: url(/images/scroll.png) no-repeat center;
  background-size: contain;
  -webkit-transition: all .5s ease-in-out;
  transition: all .5s ease-in-out;
  /* cursor: url(https://cdn.jsdelivr.net/gh/moezx/cdn@3.1.9/img/Sakura/cursor/No_Disponible.cur), auto; */
  cursor: url(/images/cursor/No_Disponible.cur), auto;
  opacity: 1
}

.cd-top.cd-is-visible {
  opacity: 1;
  top: -326px
}

.cd-top.cd-fade-out {
  opacity: 1
}

.cd-top:hover {
  opacity: 1
}

.cd-top span {
  display: none;
  color: #000;
  position: absolute;
  bottom: 0;
  height: 20px;
  width: 50px;
  text-align: center
}

@media screen and (max-width:860px) {
  .cd-top {
      display: none;
      height: 60px;
      width: 50px
  }
  .cd-top span {
      height: 10px;
      width: 50px
  }
}

#moblieGoTop {
  display: none;
  position: fixed;
  bottom: 10px;
  right: 10px;
  z-index: 99;
  border: 0;
  outline: 0;
  background-color: #fff;
  color: #404040;
  cursor: pointer;
  padding: 15px;
  border-radius: 10px;
  border-radius: 12px;
  box-shadow: 0 0 2px 0 rgba(0, 0, 0, .12), 0 2px 2px 0 rgba(0, 0, 0, .24);
  transition: box-shadow .2s ease
}
#moblieGoTop:hover {
  background-color: #fff;
  opacity: .8
}
.changeSkin-gear {
  position: fixed;
  bottom: 0;
  left: auto;
  right: 5px;
  width: auto;
  height: auto;
  z-index: 99;
  white-space: nowrap;
  padding: 10px 10px;
  cursor: pointer;
  border-radius: 10px 10px 0 0
}
</style>

<!-- æ·»åŠ å°çŒ«ç½®é¡¶ -->
<a class="cd-top faa-float animated cd-is-visible cd-fade-out" style="top: -500px;"></a>
<button id="moblieGoTop" title="Go to top" style="display: none;font-size: xx-large;"><i class="fa fa-chevron-up" aria-hidden="true"></i>ğŸ”</button>

<!-- <div class="scroll "> <i class="fa fa-arrow-up" style="margin-left: 4px;"></i>
Topâ¬†ï¸
<span class="scrollpercent" style="margin-left: -2px;"></span>
<span style="margin-right: 4px; margin-left: -4px;">%</span>
</div> -->

<!-- https://www.huangpinke.com/2018/08/24/add-back-to-top-button.html -->
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  
<link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">

  
<script src="../../../../fancybox/jquery.fancybox.pack.js"></script>




<script src="../../../../js/script.js"></script>




<script>
  (function(){
      var bp = document.createElement('script');
      bp.src = '//push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script>

<!-- mermaidå›¾ -->

  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>

    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="../../../../index.html" class="mobile-nav-link">é¦–é¡µ</a>
  
    <a href="../../../../archives" class="mobile-nav-link">å½’æ¡£</a>
  
    <a href="../../../../quick-notes" class="mobile-nav-link">å°æŠ„</a>
  
    <a href="../../../../about" class="mobile-nav-link">å…³äº</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>

</html>